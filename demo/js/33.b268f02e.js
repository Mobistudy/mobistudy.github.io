(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[33],{"08ed":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"q-pa-md"},[e.devices.length>1?n("div",[e._v(e._s(e.$t("studies.tasks.miband3.moreDevices")))]):e._e(),e.devices.length>1?n("q-list",{staticClass:"q-mt-md",attrs:{bordered:""}},e._l(e.devices,(function(t){return n("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:t.id,attrs:{clickable:"",id:t.id},on:{click:function(n){return e.connect(t)}}},[n("q-item-section",[e._v(e._s(t.id))])],1)})),1):e._e(),n("q-dialog",{attrs:{"transition-show":"scale","transition-hide":"scale","no-esc-dismiss":"","no-backdrop-dismiss":""},model:{value:e.tapToAuthDialog,callback:function(t){e.tapToAuthDialog=t},expression:"tapToAuthDialog"}},[n("q-card",[n("div",{staticClass:"q-pa-sm"},[n("q-img",{attrs:{src:"https://svgshare.com/i/RBV.svg"}})],1),n("q-card-section",[n("div",{staticClass:"row no-wrap items-center"},[n("div",{staticClass:"col text-h6 ellipsis"},[e._v("\n            "+e._s(e.$t("studies.tasks.miband3.tap"))+"\n          ")])])])],1)],1),n("q-inner-loading",{attrs:{showing:e.showSearching}},[n("div",{staticClass:"text-overline",attrs:{color:"dark-grey"}},[e._v(e._s(e.$t("studies.tasks.miband3.searching")))]),n("q-spinner-dots",{attrs:{size:"40px",color:"primary"}})],1),n("q-inner-loading",{attrs:{showing:e.showConnecting}},[n("div",{staticClass:"text-overline",attrs:{color:"dark-grey"}},[e._v(e._s(e.$t("studies.tasks.miband3.connecting")))]),n("q-spinner-dots",{attrs:{size:"40px",color:"primary"}})],1)],1)},s=[],c=n("967e"),i=n.n(c),r=(n("386d"),n("96cf"),n("fa84")),o=n.n(r),d=(n("c5f6"),n("e995")),l=n("6a6d"),u=n("9bf1"),h={name:"Miband3ConnectPage",props:{studyKey:String,taskId:Number},data:function(){return{devices:[],tapToAuthDialog:!1,showSearching:!1,showConnecting:!1}},methods:{search:function(){var e=this;return o()(i.a.mark((function t(){return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.devices=[],e.showSearching=!0,t.prev=2,t.next=5,d["a"].search(5e3);case 5:e.devices=t.sent,console.log("All devices found:",e.devices),0===e.devices.length?e.$q.dialog({title:e.$t("studies.tasks.miband3.noDeviceTitle"),message:e.$t("studies.tasks.miband3.noDevice"),cancel:e.$t("common.cancel"),ok:e.$t("common.retry"),persistent:!0}).onOk((function(t){e.search()})).onCancel((function(){e.abandon()})):1===e.devices.length?(console.log("Found device:",e.devices[0]),e.connect(e.devices[0])):e.devices.sort((function(e,t){return t.rssi-e.rssi})),t.next=14;break;case 10:t.prev=10,t.t0=t["catch"](2),console.error("Search error",t.t0),e.$q.dialog({title:e.$t("errors.error"),message:e.$t("studies.tasks.miband3.searchFailed"),cancel:e.$t("common.cancel"),ok:e.$t("common.retry"),persistent:!0}).onOk((function(t){e.search()})).onCancel((function(){e.abandon()}));case 14:e.showSearching=!1;case 15:case"end":return t.stop()}}),t,null,[[2,10]])})))()},connect:function(e){var t=this;return o()(i.a.mark((function n(){var a,s;return i.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.showConnecting=!0,n.prev=1,n.next=4,d["a"].connect(e);case 4:return e.authenticated||(t.tapToAuthDialog=!0),n.next=7,d["a"].authenticate(e.authenticated);case 7:return a=u["a"].user,n.next=10,l["a"].getTaskDescription(t.studyKey,t.taskId);case 10:return s=n.sent,n.next=13,d["a"].configure(a,s.hrInterval);case 13:return t.tapToAuthDialog=!1,t.showConnecting=!1,e.authenticated=!0,n.next=18,l["a"].setDeviceMiBand3(e);case 18:t.moveToDownloadPage(),n.next=26;break;case 21:n.prev=21,n.t0=n["catch"](1),console.error(n.t0),t.showConnecting=!1,t.$q.dialog({title:t.$t("errors.error"),message:t.$t("studies.tasks.miband3.connectionFail"),cancel:t.$t("common.cancel"),ok:t.$t("common.retry"),persistent:!0}).onOk(o()(i.a.mark((function n(){return i.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,d["a"].disconnect();case 2:e.authenticated?t.connect(e):t.search();case 3:case"end":return n.stop()}}),n)})))).onCancel((function(){t.abandon()}));case 26:case"end":return n.stop()}}),n,null,[[1,21]])})))()},abandon:function(){try{d["a"].disconnect()}catch(e){console.error("cannot disconnect miband3",e)}this.$router.push({name:"tasker",params:{rescheduleTasks:!0}})},moveToDownloadPage:function(){this.$router.push({name:"miband3DataDownload",params:{studyKey:this.studyKey,taskId:this.taskId}})}},mounted:function(){var e=this;return o()(i.a.mark((function t(){var n;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,l["a"].getDeviceMiBand3();case 2:n=t.sent,n?e.connect(n):e.search();case 4:case"end":return t.stop()}}),t)})))()}},m=h,p=n("2877"),v=n("1c1c"),g=n("66e5"),f=n("4074"),k=n("24e8"),w=n("f09f"),b=n("068f"),$=n("a370"),x=n("74f7"),C=n("8380"),D=n("714f"),q=n("eebe"),y=n.n(q),_=Object(p["a"])(m,a,s,!1,null,null,null);t["default"]=_.exports;y()(_,"components",{QList:v["a"],QItem:g["a"],QItemSection:f["a"],QDialog:k["a"],QCard:w["a"],QImg:b["a"],QCardSection:$["a"],QInnerLoading:x["a"],QSpinnerDots:C["a"]}),y()(_,"directives",{Ripple:D["a"]})}}]);