(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[24],{"906a":function(e,t,s){"use strict";s.r(t);var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-page",{attrs:{padding:""}},[s("div",{staticClass:"text-h5 text-center"},[e._v("\n    "+e._s(e.$t("studies.consent.informedConsent"))+"\n  ")]),s("div",{staticClass:"text-body2"},[e._v("\n    "+e._s(e.$t("studies.consent.consentExplanation"))+"\n  ")]),s("q-list",[e.studyDescription.consent.extraItems?s("div",[e._l(e.studyDescription.consent.extraItems,(function(t,n){return s("q-item",{key:n},[s("q-item-section",[s("q-item-label",[e._v(e._s(t.description[e.$i18n.locale]))])],1),s("q-item-section",{attrs:{avatar:""}},[s("q-checkbox",{attrs:{disable:!t.optional},model:{value:e.consentedExtraItems[n],callback:function(t){e.$set(e.consentedExtraItems,n,t)},expression:"consentedExtraItems[extraIndex]"}})],1)],1)})),s("q-separator",{attrs:{inset:""}})],2):e._e(),s("q-list",e._l(e.studyDescription.consent.taskItems,(function(t,n){return s("consentItem",{key:n,attrs:{taskIndex:n,taskItem:t,taskType:e.taskType,consentedTaskItems:e.consentedTaskItems,studyDescription:e.studyDescription}})})),1),e.remindersPermissionNeeded?s("q-separator"):e._e(),e.remindersPermissionNeeded?s("q-item",[s("q-item-section",{attrs:{label:e.$t("studies.consent.remindersConsent")}},[s("div",[s("div",{staticClass:"q-my-md"},[e._v("\n            "+e._s(e.$t("studies.consent.remindersOSPermission"))+"\n          ")]),e.remindersPermissionNeeded&&!e.remindersPermissionGiven?s("q-item-label",[s("div",{staticClass:"q-mt-sm text-secondary"},[e._v("\n          "+e._s(e.$t("studies.consent.giveRemindersOSPermission"))+"\n          ")])]):e._e()],1)]),s("q-item-section",{attrs:{avatar:""}},[s("q-checkbox",{attrs:{value:e.remindersPermissionGiven},nativeOn:{click:function(t){e.remindersPermissionGiven?e.remindersPermissionGiven=!1:e.requestNotificationsPermission()}}})],1)],1):e._e()],1),s("div",{staticClass:"q-my-md row justify-evenly"},[s("q-btn",{attrs:{label:e.$t("common.reject"),color:"negative",flat:""},on:{click:function(t){return e.deny()}}}),s("q-btn",{attrs:{label:e.$t("studies.consent.joinStudy"),color:"positive",disabled:!e.canAccept},on:{click:function(t){return e.accept()}}})],1)],1)},r=[],i=(s("7514"),s("967e")),a=s.n(i),o=(s("96cf"),s("fa84")),c=s.n(o),u=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-item",[s("q-item-section",[s("q-item-label",{staticClass:"q-my-md"},[e._v(e._s(e.taskItem.description[e.$i18n.locale]))]),"form"===e.taskType[e.taskIndex]||e.consentedTaskItems[e.taskIndex]?e._e():s("q-item-label",[s("div",{staticClass:"q-mt-sm text-secondary"},[e._v("\n            "+e._s(e.$t("studies.consent.OSpermission"))+"\n            "+e._s(e.$t("studies.consent.giveOSPermission"))+"\n        ")])])],1),s("q-item-section",{attrs:{avatar:""}},[s("q-checkbox",{attrs:{value:e.consentedTaskItems[e.taskIndex]},nativeOn:{click:function(t){e.consentedTaskItems[e.taskIndex]?e.rejectPermission(e.taskIndex):e.requestPermission(e.taskIndex)}}})],1)],1)},d=[],m=s("4468"),p=s("efed"),l={props:["taskItem","taskType","taskIndex","consentedTaskItems","studyDescription"],methods:{requestPermission:function(e){var t=this;return c()(a.a.mark((function s(){var n,r;return a.a.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(s.prev=0,"dataQuery"!==t.taskType[e]){s.next=8;break}return n=t.studyDescription.consent.taskItems[e].taskId,r=t.studyDescription.tasks.find((function(e){return e.id===n})),s.next=6,m["a"].requestAuthorization([{read:[r.dataType]}]);case 6:s.next=27;break;case 8:if("smwt"!==t.taskType[e]){s.next=21;break}return s.next=11,p["a"].geolocation.isAvailable();case 11:if(!s.sent){s.next=14;break}return s.next=14,p["a"].geolocation.requestPermission();case 14:return s.next=16,p["a"].pedometer.isAvailable();case 16:if(!s.sent){s.next=19;break}return s.next=19,p["a"].pedometer.requestPermission();case 19:s.next=27;break;case 21:if("qcst"!==t.taskType[e]){s.next=27;break}return s.next=24,p["a"].pedometer.isAvailable();case 24:if(!s.sent){s.next=27;break}return s.next=27,p["a"].pedometer.requestPermission();case 27:t.$set(t.consentedTaskItems,e,!0),t.$q.notify({color:"positive",message:t.$i18n.t("studies.consent.OSPermissionGiven"),icon:"check"}),s.next=35;break;case 31:s.prev=31,s.t0=s["catch"](0),console.error("Cannot get OS authorisation for task",s.t0),t.$q.notify({color:"negative",message:t.$i18n.t("studies.consent.OSPermissionNotGiven")+": "+s.t0.message,icon:"report_problem"});case 35:case"end":return s.stop()}}),s,null,[[0,31]])})))()},rejectPermission:function(e){var t=this;return c()(a.a.mark((function s(){return a.a.wrap((function(s){while(1)switch(s.prev=s.next){case 0:t.$set(t.consentedTaskItems,e,!1);case 1:case"end":return s.stop()}}),s)})))()}}},k=l,v=s("2877"),f=s("66e5"),y=s("4074"),x=s("0170"),h=s("8f8e"),I=s("eebe"),b=s.n(I),q=Object(v["a"])(k,u,d,!1,null,null,null),P=q.exports;b()(q,"components",{QItem:f["a"],QItemSection:y["a"],QItemLabel:x["a"],QCheckbox:h["a"]});var g=s("9bf1"),$=s("6a6d"),_=s("aa9c"),w=s("ee76"),D={name:"ConsentItemsPage",props:["studyDescription"],components:{consentItem:P},data:function(){return{consentedExtraItems:[],consentedTaskItems:[],remindersPermissionNeeded:!0,remindersPermissionGiven:!1}},created:function(){var e=this;return c()(a.a.mark((function t(){var s,n,r;return a.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,w["a"].hasPermission();case 2:if(s=t.sent,e.remindersPermissionNeeded=!s,e.remindersPermissionGiven=s,e.studyDescription.consent.extraItems&&e.studyDescription.consent.extraItems.length)for(n=0;n<e.studyDescription.consent.extraItems.length;n++)e.studyDescription.consent.extraItems[n].optional?e.consentedExtraItems.push(!1):e.consentedExtraItems.push(!0);for(r=0;r<e.studyDescription.consent.taskItems.length;r++)e.consentedTaskItems.push(!1);case 7:case"end":return t.stop()}}),t)})))()},computed:{taskType:function(){var e=this;return this.studyDescription.consent.taskItems.map((function(t){return e.studyDescription.tasks.find((function(e){return e.id===t.taskId})).type}))},canAccept:function(){if(!this.remindersPermissionGiven)return!1;for(var e=0;e<this.taskType.length;e++)if("dataQuery"===this.taskType[e]&&!this.consentedTaskItems[e])return!1;return!0}},methods:{requestNotificationsPermission:function(){var e=this;return c()(a.a.mark((function t(){return a.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,w["a"].requestPermission();case 3:e.remindersPermissionGiven=t.sent,e.$q.notify({color:"positive",message:e.$i18n.t("studies.consent.OSPermissionGiven"),icon:"check"}),t.next=11;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error("Cannot get authorisation for sending reminders",t.t0),e.$q.notify({color:"negative",message:e.$i18n.t("studies.consent.OSPermissionNotGiven")+": "+t.t0.message,icon:"report_problem"});case 11:case"end":return t.stop()}}),t,null,[[0,7]])})))()},accept:function(){var e=this;return c()(a.a.mark((function t(){var s,n,r,i;return a.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,s={studyKey:e.studyDescription._key,currentStatus:"accepted",acceptedTS:new Date,reminders:e.remindersPermissionGiven,taskItemsConsent:[],extraItemsConsent:[]},e.studyDescription.consent.extraItems)for(n=0;n<e.studyDescription.consent.extraItems.length;n++)s.extraItemsConsent.push({consented:e.consentedExtraItems[n]});if(e.studyDescription.consent.taskItems)for(r=0;r<e.studyDescription.consent.taskItems.length;r++)s.taskItemsConsent.push({taskId:e.studyDescription.consent.taskItems[r].taskId,consented:e.consentedTaskItems[r]});return t.next=6,_["a"].updateStudyStatus(g["a"].user._key,e.studyDescription._key,s);case 6:return t.next=8,$["a"].getStudiesParticipation();case 8:return i=t.sent,i||(i=[]),i.push(s),t.next=13,$["a"].setStudiesParticipation(i);case 13:e.$router.push({name:"studies"}),t.next=20;break;case 16:t.prev=16,t.t0=t["catch"](0),console.error("Cannot join study",t.t0),e.$q.notify({color:"negative",message:e.$i18n.t("errors.connectionError")+": "+t.t0.message,icon:"report_problem"});case 20:e.$router.push({name:"accepted",params:{studyDescription:e.studyDescription}});case 21:case"end":return t.stop()}}),t,null,[[0,16]])})))()},deny:function(){var e=this;return c()(a.a.mark((function t(){return a.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$q.dialog({title:e.$i18n.t("studies.discardStudy"),message:e.$i18n.t("studies.discardStudyConfirm"),color:"primary",ok:e.$i18n.t("common.yes"),cancel:e.$i18n.t("common.cancel")}).onOk(c()(a.a.mark((function t(){var s,n;return a.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return s={studyKey:e.studyDescription._key,currentStatus:"rejected",rejectedTS:new Date},t.prev=1,t.next=4,_["a"].updateStudyStatus(g["a"].user._key,e.studyDescription._key,s);case 4:return t.next=6,$["a"].getStudiesParticipation();case 6:return n=t.sent,n||(n=[]),n.push(s),t.next=11,$["a"].setStudiesParticipation(n);case 11:e.$router.push({name:"studies"}),t.next=18;break;case 14:t.prev=14,t.t0=t["catch"](1),console.error("Cannot connect to server",t.t0),e.$q.notify({color:"negative",message:e.$i18n.t("errors.connectionError")+": "+t.t0.message,icon:"report_problem"});case 18:case"end":return t.stop()}}),t,null,[[1,14]])}))));case 1:case"end":return t.stop()}}),t)})))()}}},S=D,T=s("9989"),C=s("1c1c"),O=s("eb85"),Q=s("9c40"),G=Object(v["a"])(S,n,r,!1,null,null,null);t["default"]=G.exports;b()(G,"components",{QPage:T["a"],QList:C["a"],QItem:f["a"],QItemSection:y["a"],QItemLabel:x["a"],QCheckbox:h["a"],QSeparator:O["a"],QBtn:Q["a"]})}}]);