(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{"15a1":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-page",{attrs:{padding:""}},[!e.finished&&e.currentQuestion?s("div",[s("transition",{attrs:{"enter-active-class":"animated "+this.slideName,"leave-active-class":"fadeOut",mode:"out-in"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:""!=e.slideName,expression:"slideName != ''"}],key:""},[s("div",{staticClass:"text-center text-subtitle1"},[s("div",{domProps:{innerHTML:e._s(e.currentQuestion.text[e.$i18n.locale])}})]),s("div",{staticClass:"text-center text-subtitle2 q-mb-md"},[s("div",{domProps:{innerHTML:e._s(e.currentQuestion.helper[e.$i18n.locale])}})]),s("q-input",{directives:[{name:"show",rawName:"v-show",value:"freetext"===e.currentQuestion.type,expression:"currentQuestion.type === 'freetext'"}],attrs:{type:"textarea",label:e.$t("studies.tasks.form.freeTextExplanation"),rows:"3",outlined:""},model:{value:e.freetextAnswer,callback:function(t){e.freetextAnswer=t},expression:"freetextAnswer"}}),e._l(e.currentQuestion.answerChoices,(function(t,i){return s("div",{directives:[{name:"show",rawName:"v-show",value:"singleChoice"===e.currentQuestion.type,expression:"currentQuestion.type === 'singleChoice'"}],key:"sc"+i},[s("q-radio",{attrs:{val:t.id,label:t.text[e.$i18n.locale]},model:{value:e.singleChoiceAnswer,callback:function(t){e.singleChoiceAnswer=t},expression:"singleChoiceAnswer"}})],1)})),e._l(e.currentQuestion.answerChoices,(function(t,i){return s("div",{directives:[{name:"show",rawName:"v-show",value:"multiChoice"===e.currentQuestion.type,expression:"currentQuestion.type === 'multiChoice'"}],key:"mc"+i},[s("q-checkbox",{attrs:{val:t.id,label:t.text[e.$i18n.locale]},model:{value:e.multiChoiceAnswer,callback:function(t){e.multiChoiceAnswer=t},expression:"multiChoiceAnswer"}})],1)})),s("div",{directives:[{name:"show",rawName:"v-show",value:"textOnly"===e.currentQuestion.type,expression:"currentQuestion.type === 'textOnly'"}],staticClass:"text-subtitle1 q-mb-md"},["textOnly"===e.currentQuestion.type?s("div",[s("div",{domProps:{innerHTML:e._s(e.currentQuestion.html[e.$i18n.locale])}})]):e._e()])],2)]),"textOnly"!==e.currentQuestion.type?s("div",{staticClass:"row justify-around"},[s("q-btn",{attrs:{"no-caps":"",flat:"",label:e.$t("studies.tasks.form.removeAnswer"),color:"negative","icon-right":"cancel"},on:{click:function(t){return e.clearAnswer()}}})],1):e._e(),s("div",{staticClass:"row justify-around q-mb-xl fixed-bottom"},[s("q-btn",{directives:[{name:"show",rawName:"v-show",value:!e.isFirstQuestion,expression:"!isFirstQuestion"}],attrs:{icon:"arrow_back",color:"secondary",label:e.$t("common.back")},on:{click:function(t){return e.back()}}}),s("q-btn",{directives:[{name:"show",rawName:"v-show",value:e.isAnswered,expression:"isAnswered"}],attrs:{"icon-right":"arrow_forward",color:"primary",label:e.$t("common.next")},on:{click:function(t){return e.next()}}}),s("q-btn",{directives:[{name:"show",rawName:"v-show",value:!e.isAnswered,expression:"!isAnswered"}],attrs:{"icon-right":"arrow_forward",color:"warning",label:e.$t("common.skip")},on:{click:function(t){return e.next()}},model:{value:e.singleChoiceAnswer,callback:function(t){e.singleChoiceAnswer=t},expression:"singleChoiceAnswer"}})],1),e.currentQuestion.footer?s("div",{staticClass:"text-left text-caption absolute-bottom q-pa-sm"},[e._v("\n      "+e._s(e.currentQuestion.footer[e.$i18n.locale])+"\n    ")]):e._e()],1):e._e(),e.finished?s("div",[s("div",{staticClass:"text-center text-h6"},[e._v("\n      "+e._s(e.$t("studies.tasks.form.formCompleted"))+"\n    ")]),s("div",{staticClass:"row justify-around q-ma-lg"},[s("q-btn",{attrs:{color:"primary",loading:e.loading,label:e.$t("common.send")},on:{click:function(t){return e.send()}}})],1)]):e._e(),s("q-inner-loading",{attrs:{showing:e.isRetrieving}},[s("div",{staticClass:"text-overline"},[e._v(e._s(e.$t("studies.tasks.miband3.dataSending")))]),s("q-spinner-oval",{attrs:{size:"50px",color:"primary"}})],1)],1)},n=[],r=(s("e01a"),s("e6cf"),s("ddb0"),s("aa9c")),o=s("6a6d"),a=s("9bf1"),c={name:"FormPage",props:{studyKey:String,taskId:Number,formKey:String},data:function(){return{formDescr:{},responses:[],oldResponses:[],freetextAnswer:void 0,singleChoiceAnswer:void 0,multiChoiceAnswer:[],introduction:{title:"",description:""},finished:!1,currentQuestion:void 0,loading:!1,slideName:""}},async created(){this.isRetrieving=!0;const e=this.formKey;try{let t=await o["a"].getFormDescription(e);t||(this.$q.loading.show(),t=await r["a"].getForm(e),await o["a"].setFormDescription(e,t),this.$q.loading.hide()),this.formDescr=t,this.introduction={title:this.formDescr.name,description:this.formDescr.description},this.currentQuestion=this.formDescr.questions[0],setTimeout((()=>{this.slideName="fadeInDown"}),10)}catch(t){console.error(t),this.$q.notify({color:"negative",message:"Cannot retrieve information about the form: "+t.message,icon:"report_problem",onDismiss(){this.$router.go(-1)}})}this.isRetrieving=!1},computed:{isFirstQuestion(){return!this.introduction&&this.currentQuestion.id===this.formDescr.questions[0].id},isAnswered(){return"singleChoice"===this.currentQuestion.type&&this.singleChoiceAnswer||"freetext"===this.currentQuestion.type&&this.freetextAnswer||"multiChoice"===this.currentQuestion.type&&this.multiChoiceAnswer.length||"textOnly"===this.currentQuestion.type}},methods:{next(){this.slideName="";let e=this.currentQuestion.nextDefaultId,t={questionId:this.currentQuestion.id,questionType:this.currentQuestion.type,questionText:this.currentQuestion.text,answer:void 0,timeStamp:new Date};if("freetext"===this.currentQuestion.type)t.answer=this.freetextAnswer;else if("singleChoice"===this.currentQuestion.type){let s=this.currentQuestion.answerChoices.find((e=>e.id===this.singleChoiceAnswer));s&&(t.answer={answerText:s.text,answerId:s.id},s.nextQuestionId&&(e=s.nextQuestionId))}else if("multiChoice"===this.currentQuestion.type){t.answer=[];for(let e of this.multiChoiceAnswer){let s=this.currentQuestion.answerChoices.find((t=>t.id===e));t.answer.push({answerText:s.text,answerId:s.id})}}if(this.responses.push(t),this.freetextAnswer=void 0,this.multiChoice=void 0,this.singleChoiceAnswer=void 0,!e)if(this.currentQuestion.id===this.formDescr.questions[this.formDescr.questions.length-1].id)e="ENDFORM";else{let t=this.formDescr.questions.findIndex((e=>e.id===this.currentQuestion.id));e="Q"+(t+2)}this.oldResponses[1]&&this.oldResponses[1].questionId===e?(this.oldResponses[1].answer?this.singleChoiceAnswer=this.oldResponses[1].answer.answerId:this.singleChoiceAnswer=void 0,this.oldResponses.shift()):this.oldResponses=[],"ENDFORM"===e?this.finished=!0:this.currentQuestion=this.formDescr.questions.find((t=>t.id===e)),setTimeout((()=>{this.slideName="slideInRight"}),10)},back(){this.slideName="",this.freetextAnswer=void 0,this.multiChoice=void 0,this.singleChoiceAnswer=void 0;const e=this.responses[this.responses.length-1];this.currentQuestion=this.formDescr.questions.find((t=>t.id===e.questionId)),e.answer&&("freetext"===this.currentQuestion.type?this.freetextAnswer=e.answer:"singleChoice"===this.currentQuestion.type?this.singleChoiceAnswer=e.answer.answerId:"multiChoice"===this.currentQuestion.type&&(this.multiChoice=e.map((e=>e.answer.answerId)))),this.oldResponses.unshift(this.responses.pop()),setTimeout((()=>{this.slideName="slideInLeft"}),10)},async send(){this.loading=!0;const e=this.studyKey,t=Number(this.taskId);let s={userKey:a["a"].user._key,studyKey:e,taskId:t,createdTS:new Date,responses:this.responses};try{await r["a"].sendAnswers(s),await o["a"].setTaskCompletion(e,t,new Date),this.$router.push("/home")}catch(i){console.error(i),this.loading=!1,this.$q.notify({color:"negative",message:this.$t("errors.connectionError")+" "+i.message,icon:"report_problem",onDismiss(){this.$router.push("/home")}})}},clearAnswer(){"singleChoice"===this.currentQuestion.type&&(this.singleChoiceAnswer=void 0),"freetext"===this.currentQuestion.type&&(this.freetextAnswer=void 0),"multiChoice"===this.currentQuestion.type&&(this.multiChoiceAnswer=[])}}},u=c,l=(s("feec"),s("2877")),h=s("9989"),d=s("27f9"),m=s("3786"),w=s("8f8e"),p=s("9c40"),f=s("74f7"),v=s("1b41"),x=s("eebe"),g=s.n(x),y=Object(l["a"])(u,i,n,!1,null,"7d571304",null);t["default"]=y.exports;g()(y,"components",{QPage:h["a"],QInput:d["a"],QRadio:m["a"],QCheckbox:w["a"],QBtn:p["a"],QInnerLoading:f["a"],QSpinnerOval:v["a"]})},2860:function(e,t,s){},feec:function(e,t,s){"use strict";s("2860")}}]);