(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[32],{"71a8":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{attrs:{padding:""}},[a("div",{staticClass:"row fit justify-center"},[a("div",{staticClass:"text-h5 text-center q-pt-md"},[t._v("\n      "+t._s(t.$t("accountMgmt.profile.profile"))+"\n    ")])]),a("profile-editor",{attrs:{buttonOk:t.$t("common.update")},on:{buttonOk:function(e){return t.saveProfile()}},model:{value:t.profile,callback:function(e){t.profile=e},expression:"profile"}}),a("q-separator"),a("q-item",{staticClass:"q-mt-md"},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{color:"grey",name:"security"}})],1),a("q-item-section",[a("q-item-label",[t._v(t._s(t.$t("accountMgmt.resetPassword.resetPassword")))]),a("q-item-label",{attrs:{caption:""}},[t._v(t._s(t.$t("accountMgmt.resetPassword.resetPasswordShort")))]),a("div",{staticClass:"q-my-md"},[a("q-btn",{attrs:{color:"secondary",label:t.$t("accountMgmt.resetPassword.resetPassword")},on:{click:function(e){return t.resetPwd()}}})],1)],1)],1),a("q-separator",{attrs:{inset:""}}),a("q-item",{staticClass:"q-mt-md"},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{color:"grey",name:"exit_to_app"}})],1),a("q-item-section",[a("q-item-label",[t._v(t._s(t.$t("accountMgmt.login.logout")))]),a("q-item-label",{attrs:{caption:""}},[t._v(t._s(t.$t("accountMgmt.login.logoutShort")))]),a("div",{staticClass:"q-my-md"},[a("q-btn",{attrs:{color:"warning",label:t.$t("accountMgmt.login.logout")},on:{click:function(e){return t.logout()}}})],1)],1)],1),a("q-separator",{attrs:{inset:""}}),a("q-item",{staticClass:"q-mt-md"},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{color:"grey",name:"delete_forever"}})],1),a("q-item-section",[a("q-item-label",[t._v(t._s(t.$t("accountMgmt.deleteAccount")))]),a("q-item-label",{attrs:{caption:""}},[t._v(t._s(t.$t("accountMgmt.deleteShort")))]),a("div",{staticClass:"q-my-md"},[a("q-btn",{attrs:{color:"negative",label:t.$t("common.delete")},on:{click:function(e){return t.deleteUser()}}})],1)],1)],1)],1)},s=[],i=(a("e6cf"),a("dc04")),r=a("b006"),n=a("aa9c"),c=a("6a6d"),l=a("ee76"),m=a("9bf1"),u={name:"ProfilePage",components:{ProfileEditor:r["a"]},i18n:{messages:i["a"]},data(){return{profile:{name:"",surname:"",dateOfBirth:"",country:"",language:"",sex:"",diseases:[],medications:[],lifestyle:{smoker:!1,active:!1}}}},async created(){this.$q.loading.show();try{this.profile=await n["a"].getProfile(m["a"].user._key),await m["a"].setProfile(this.profile),this.$q.loading.hide()}catch(t){this.$q.notify({color:"negative",message:this.$i18n.t("errors.connectionError")+": "+t.message,icon:"report_problem"}),this.$q.loading.hide()}},methods:{async logout(){this.$q.dialog({title:this.$i18n.t("accountMgmt.login.logout"),message:this.$i18n.t("accountMgmt.login.logoutConfirmation"),ok:this.$i18n.t("accountMgmt.login.logout"),cancel:this.$i18n.t("common.cancel")}).onOk((async()=>{try{await m["a"].logout()}catch(t){console.log(t)}n["a"].setToken(""),this.$router.push("/login")}))},async saveProfile(){try{let t="";this.profile.dateOfBirth instanceof Date?t=this.profile.dateOfBirth.toISOString().substring(0,10):"string"===typeof this.profile.dateOfBirth?t=this.profile.dateOfBirth.substring(0,10):(t=this.profile.dateOfBirth,console.error(this.profile.dateOfBirth+" cannot be cut to date only"));let e=this.profile;e.dateOfBirth=t,e.userKey=m["a"].user._key,e.updatedTS=new Date,await n["a"].updateProfile(e),await m["a"].setProfile(e),this.$router.push({name:"tasker",params:{rescheduleTasks:!0,checkNewStudies:!0}})}catch(t){this.$q.notify({color:"negative",message:this.$i18n.t("errors.connectionError")+": "+t.message,icon:"report_problem"})}},async resetPwd(){try{await n["a"].resetPW(m["a"].user.email.toLowerCase());let t=m["a"].user.email;l["a"].cancelAll(),await m["a"].logout(),n["a"].unsetToken(),await c["a"].emptyUserData(),this.$router.push({name:"changepw",params:{email:t}})}catch(t){this.$q.notify({color:"negative",message:this.$i18n.t("errors.connectionError")+": "+t.message,icon:"report_problem"})}},async deleteUser(){this.$q.dialog({title:this.$i18n.t("common.warning"),message:this.$i18n.t("accountMgmt.deleteWarning"),ok:{label:this.$i18n.t("common.delete"),push:!0,color:"negative"},cancel:{push:!0,color:"grey",flat:!0}}).onOk((async()=>{try{await n["a"].deleteUser(m["a"].user.user._key),this.$router.push("/login")}catch(t){this.$q.notify({color:"negative",message:this.$i18n.t("errors.connectionError")+": "+t.message,icon:"report_problem"})}}))}}},g=u,d=a("2877"),h=a("9989"),p=a("eb85"),f=a("66e5"),q=a("4074"),$=a("0016"),y=a("0170"),b=a("9c40"),w=a("eebe"),v=a.n(w),_=Object(d["a"])(g,o,s,!1,null,null,null);e["default"]=_.exports;v()(_,"components",{QPage:h["a"],QSeparator:p["a"],QItem:f["a"],QItemSection:q["a"],QIcon:$["a"],QItemLabel:y["a"],QBtn:b["a"]})}}]);