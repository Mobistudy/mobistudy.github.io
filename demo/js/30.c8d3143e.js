(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[30],{"987b":function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-page",{attrs:{padding:""}},[n("q-tabs",{staticClass:"text-grey",attrs:{dense:"","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[n("q-tab",{attrs:{name:"info",icon:"info",label:t.$t("common.info")}}),n("q-tab",{attrs:{name:"privacy",icon:"lock",label:t.$t("common.privacy")}}),"accepted"==t.studyParticipation.currentStatus?n("q-tab",{attrs:{name:"consent",icon:"done",label:t.$t("common.consent")}}):t._e()],1),n("q-separator"),n("q-tab-panels",{attrs:{animated:""},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[n("q-tab-panel",{attrs:{name:"info"}},[n("study-info",{attrs:{studyDescription:t.studyDescription}})],1),n("q-tab-panel",{attrs:{name:"privacy"},domProps:{innerHTML:t._s(t.studyDescription.consent.privacyPolicy[t.$i18n.locale].replace(new RegExp("\n","g"),"<br>"))}}),n("q-tab-panel",{attrs:{name:"consent"}},[n("q-list",[n("q-item",[n("q-item-section",[n("q-item-label",{staticClass:"text-subtitle1"},[t._v(t._s(t.$t("studies.consent.itemsExplanation"))+":")])],1)],1)],1),t.studyDescription.consent.extraItems?n("q-list",t._l(t.studyDescription.consent.extraItems,(function(e,s){return n("q-item",{key:s},[n("q-item-section",[n("q-item-label",[t._v(t._s(e.description[t.$i18n.locale]))])],1),n("q-item-section",{attrs:{avatar:""}},[n("q-checkbox",{attrs:{disabled:!e.optional},model:{value:t.consentedExtraItems[s],callback:function(e){t.$set(t.consentedExtraItems,s,e)},expression:"consentedExtraItems[extraIndex]"}})],1)],1)})),1):t._e(),t._l(t.studyDescription.consent.taskItems,(function(e,s){return n("q-list",{key:s},[n("q-item",[n("q-item-section",[n("q-item-label",{staticClass:"q-my-md"},[t._v(t._s(e.description[t.$i18n.locale]))]),"form"!==t.taskType[s]&&!t.permissionsGiven[s]||"form"!==t.taskType[s]&&!t.consentedTaskItems[s]?n("q-item-label",[n("div",{staticClass:"q-mt-sm text-secondary"},[t._v("\n                "+t._s(t.$t("studies.consent.OSpermission"))+"\n                "+t._s(t.$t("studies.consent.giveOSPermission"))+"\n              ")])]):t._e()],1),n("q-item-section",{attrs:{avatar:""}},[n("q-checkbox",{nativeOn:{click:function(e){(t.consentedTaskItems[s]||!t.permissionsGiven[s])&&t.requestDQPermission(s)}},model:{value:t.consentedTaskItems[s],callback:function(e){t.$set(t.consentedTaskItems,s,e)},expression:"consentedTaskItems[taskIndex]"}})],1)],1)],1)})),n("q-separator"),n("q-list",[n("q-item",[n("q-item-section",[n("q-item-label",[t._v(t._s(t.$t("studies.consent.remindersConsent")))]),n("q-item-label",{attrs:{caption:""}},[t._v(t._s(t.$t("studies.consent.remindersOSPermission")))]),n("q-btn",{staticClass:"q-mt-lg",attrs:{label:t.$t("studies.consent.giveRemindersOSPermission"),disabled:!t.reminders||t.remindersPermissionGiven},on:{click:function(e){return t.requestNotificationsPermission()}}})],1),n("q-item-section",{attrs:{avatar:""}},[n("q-checkbox",{model:{value:t.reminders,callback:function(e){t.reminders=e},expression:"reminders"}})],1)],1)],1),n("div",{staticClass:"q-my-md row justify-center"},[n("q-btn",{attrs:{label:t.$t("studies.consent.updateConsent"),color:"primary",disabled:!t.canUpdate},on:{click:function(e){return t.updateConsent()}}})],1),n("div",{staticClass:"q-my-md row justify-center"},[n("q-btn",{attrs:{label:t.$t("studies.consent.withdraw"),color:"negative"},on:{click:function(e){return t.withdraw()}}})],1)],2)],1)],1)},i=[],a=(n("7514"),n("967e")),r=n.n(a),o=(n("96cf"),n("fa84")),c=n.n(o),d=n("b626"),u=n("9bf1"),m=n("6a6d"),p=n("aa9c"),l=n("4468"),y=n("ee76"),f={name:"StudyConfigPage",props:["studyDescription"],components:{StudyInfo:d["a"]},data:function(){return{consentedExtraItems:[],consentedTaskItems:[],permissionsGiven:[],studyParticipation:{},reminders:!1,remindersPermissionNeeded:!0,remindersPermissionGiven:!1,tab:"info"}},created:function(){var t=this;return c()(r.a.mark((function e(){var n,s,i;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,m["a"].getStudyParticipation(t.studyDescription._key);case 2:if(t.studyParticipation=e.sent,"withdrawn"===t.studyParticipation.currentStatus||"completed"===t.studyParticipation.currentStatus){e.next=17;break}if(t.reminders=t.studyParticipation.reminders,!t.reminders){e.next=10;break}t.remindersPermissionNeeded=!1,t.remindersPermissionGiven=!0,e.next=15;break;case 10:return e.next=12,y["a"].hasPermission();case 12:n=e.sent,t.remindersPermissionNeeded=!n,t.remindersPermissionGiven=n;case 15:for(s=0;s<t.studyDescription.consent.extraItems.length;s++)t.consentedExtraItems.push(t.studyParticipation.extraItemsConsent[s].consented);for(i=0;i<t.studyDescription.consent.taskItems.length;i++)t.consentedTaskItems.push(t.studyParticipation.taskItemsConsent[i].consented),t.permissionsGiven.push(t.studyParticipation.taskItemsConsent[i].consented);case 17:case"end":return e.stop()}}),e)})))()},computed:{taskType:function(){var t=this;return this.studyDescription.consent.taskItems.map((function(e){return t.studyDescription.tasks.find((function(t){return t.id===e.taskId})).type}))},canUpdate:function(){if(this.reminders!==this.studyParticipation.reminders)return!(this.reminders&&!this.remindersPermissionGiven);if(!this.studyParticipation||!this.studyParticipation.extraItemsConsent)return!1;for(var t=0;t<this.studyParticipation.extraItemsConsent.length;t++)if(this.consentedExtraItems[t]!==this.studyParticipation.extraItemsConsent[t].consented)return!0;for(var e=0;e<this.studyParticipation.taskItemsConsent.length;e++)if(this.consentedTaskItems[e]!==this.studyParticipation.taskItemsConsent[e].consented&&this.permissionsGiven[e])return!0;return!1}},methods:{updateConsent:function(){var t=this;return c()(r.a.mark((function e(){var n,s;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(t.studyParticipation.reminders=t.reminders,n=0;n<t.studyDescription.consent.extraItems.length;n++)t.studyParticipation.extraItemsConsent[n].consented=t.consentedExtraItems[n];for(s=0;s<t.studyDescription.consent.taskItems.length;s++)t.studyParticipation.taskItemsConsent[s].consented=t.consentedTaskItems[s];return e.next=5,p["a"].updateStudyStatus(u["a"].user._key,t.studyParticipation.studyKey,t.studyParticipation);case 5:return e.next=7,m["a"].setStudyParticipation(t.studyParticipation);case 7:t.$q.notify({color:"positive",message:t.$i18n.t("studies.consent.consentUpdated"),icon:"check"});case 8:case"end":return e.stop()}}),e)})))()},requestDQPermission:function(t){var e=this;return c()(r.a.mark((function n(){var s,i;return r.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(s=e.studyDescription.consent.taskItems[t].taskId,i=e.studyDescription.tasks.find((function(t){return t.id===s})),!i||!i.dataType){n.next=14;break}return n.prev=3,n.next=6,l["a"].requestAuthorization([i.dataType]);case 6:e.$set(e.permissionsGiven,t,!0),e.$q.notify({color:"positive",message:e.$i18n.t("studies.consent.OSPermissionGiven"),icon:"check"}),n.next=14;break;case 10:n.prev=10,n.t0=n["catch"](3),console.error("Cannot get authorisation for health",n.t0),e.$q.notify({color:"negative",message:e.$i18n.t("studies.consent.OSPermissionNotGiven")+": "+n.t0.message,icon:"report_problem"});case 14:case"end":return n.stop()}}),n,null,[[3,10]])})))()},requestNotificationsPermission:function(){var t=this;return c()(r.a.mark((function e(){return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y["a"].requestPermission();case 3:t.remindersPermissionGiven=e.sent,t.$q.notify({color:"positive",message:t.$i18n.t("studies.consent.OSPermissionGiven"),icon:"check"}),e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](0),console.error("Cannot get authorisation for sending reminders",e.t0),t.$q.notify({color:"negative",message:t.$i18n.t("studies.consent.OSPermissionNotGiven")+": "+e.t0.message,icon:"report_problem"});case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))()},withdraw:function(){var t=this;return c()(r.a.mark((function e(){return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.$q.dialog({title:"Withdraw",message:"Are you sure you want to withdraw from this study? If yes, please state why",color:"negative",prompt:{model:"",type:"text"},ok:"Withdraw",cancel:"Cancel"}).onOk(function(){var e=c()(r.a.mark((function e(n){return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.studyParticipation.currentStatus="withdrawn",t.studyParticipation.withdrawalTS=new Date,t.studyParticipation.withdrawalReason=n,e.prev=3,e.next=6,p["a"].updateStudyStatus(u["a"].user._key,t.studyParticipation.studyKey,t.studyParticipation);case 6:return delete t.studyParticipation.extraItemsConsent,delete t.studyParticipation.taskItemsConsent,e.next=10,m["a"].setStudyParticipation(t.studyParticipation);case 10:t.$router.push({name:"studies"}),e.next=17;break;case 13:e.prev=13,e.t0=e["catch"](3),console.error("Cannot connect to server",e.t0),t.$q.notify({color:"negative",message:"Cannot discard this study: "+e.t0.message,icon:"report_problem"});case 17:case"end":return e.stop()}}),e,null,[[3,13]])})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})))()}}},v=f,h=n("2877"),b=n("9989"),k=n("429b"),P=n("7460"),x=n("eb85"),q=n("adad"),w=n("823b"),I=n("1c1c"),g=n("66e5"),$=n("4074"),C=n("0170"),_=n("8f8e"),S=n("9c40"),T=n("eebe"),D=n.n(T),G=Object(h["a"])(v,s,i,!1,null,null,null);e["default"]=G.exports;D()(G,"components",{QPage:b["a"],QTabs:k["a"],QTab:P["a"],QSeparator:x["a"],QTabPanels:q["a"],QTabPanel:w["a"],QList:I["a"],QItem:g["a"],QItemSection:$["a"],QItemLabel:C["a"],QCheckbox:_["a"],QBtn:S["a"]})}}]);