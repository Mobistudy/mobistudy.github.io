(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[54],{"58cf":function(e,s,t){"use strict";t.r(s);var r=function(){var e=this,s=e._self._c;return s("q-page",{attrs:{padding:""}},[s("div",{staticClass:"text-center text-h5 q-mt-lg"},[e._v("\n    "+e._s(e.$t("studies.tasks.peakflow.measurement"))+"\n  ")]),s("div",{staticClass:"text-center mobitxt2 q-mt-lg"},[s("div",{directives:[{name:"show",rawName:"v-show",value:!e.isMeasuring&&!(e.testErrors>e.maxErrors)&&0==e.completedTests,expression:"!isMeasuring && !(testErrors > maxErrors) && completedTests==0"}]},[s("div",[s("img",{staticStyle:{"max-width":"50%"},attrs:{src:"instructions/peakflow_3.svg"}})]),s("p",[e._v("\n        "+e._s(e.$t("studies.tasks.peakflow.measurementStart"))+"\n      ")])]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.isMeasuring,expression:"isMeasuring"}]},[s("div",[s("img",{staticStyle:{"max-width":"50%"},attrs:{src:"instructions/peakflow_4.svg"}})]),s("p",[e._v("\n        "+e._s(e.$t("studies.tasks.peakflow.measurementInstructions"))+"\n      ")])]),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.isMeasuring&&e.completedTests>0&&!(e.testErrors>e.maxErrors),expression:"!isMeasuring && (completedTests>0) && !(testErrors > maxErrors)"}],staticClass:"text-center text-h6 q-mt-lg",staticStyle:{"min-height":"236px"}},e._l(e.PEFs,(function(t,r){return s("p",{key:"pef"+r,attrs:{data:t}},[e._v("\n        "+e._s(r+1)+") "+e._s(t)+" L/min\n      ")])})),0),s("p",{directives:[{name:"show",rawName:"v-show",value:!e.isMeasuring&&!(e.testErrors>e.maxErrors)&&1==e.completedTests,expression:"!isMeasuring && !(testErrors > maxErrors) && completedTests==1"}]},[e._v("\n      "+e._s(e.$t("studies.tasks.peakflow.measurementCompleted1"))+"\n    ")]),s("p",{directives:[{name:"show",rawName:"v-show",value:!e.isMeasuring&&!(e.testErrors>e.maxErrors)&&2==e.completedTests,expression:"!isMeasuring && !(testErrors > maxErrors) && completedTests==2"}]},[e._v("\n      "+e._s(e.$t("studies.tasks.peakflow.measurementCompleted2"))+"\n    ")]),s("p",{directives:[{name:"show",rawName:"v-show",value:!e.isMeasuring&&!(e.testErrors>e.maxErrors)&&3==e.completedTests,expression:"!isMeasuring && !(testErrors > maxErrors) && completedTests==3"}]},[e._v("\n      "+e._s(e.$t("studies.tasks.peakflow.measurementCompleted3"))+"\n    ")]),s("p",{directives:[{name:"show",rawName:"v-show",value:e.testErrors>e.maxErrors,expression:"testErrors > maxErrors"}],staticClass:"text-weight-bold text-negative q-pa-md"},[e._v("\n      "+e._s(e.$t("studies.tasks.peakflow.measurementErrorMaxRetries"))+"\n    ")])]),s("div",{staticClass:"row justify-center q-mt-lg"},[s("q-btn",{directives:[{name:"show",rawName:"v-show",value:!(e.testErrors>e.maxErrors)&&(e.isMeasuring||e.completedTests<=e.totalTestsNumber),expression:"!(testErrors > maxErrors) && (isMeasuring || (completedTests <= totalTestsNumber))"}],staticClass:"full-width mobibtn",attrs:{color:"primary",disable:e.isMeasuring,label:e.$t("common.start")},on:{click:e.startMeasurement}}),s("q-btn",{directives:[{name:"show",rawName:"v-show",value:e.completedTests>e.totalTestsNumber&&!e.isMeasuring,expression:"completedTests > totalTestsNumber && !isMeasuring"}],staticClass:"full-width mobibtn",attrs:{color:"primary",label:e.$t("common.next")},on:{click:e.completeTest}}),s("q-btn",{directives:[{name:"show",rawName:"v-show",value:e.testErrors>e.maxErrors,expression:"testErrors > maxErrors"}],staticClass:"full-width mobibtn",attrs:{color:"negative",label:e.$t("common.next")},on:{click:e.abandonTest}})],1)])},a=[],o=(t("d9e2"),t("14d9"),t("ddb0"),t("a5f6")),i=t("ed5d"),n=t("9bf1"),m={name:"PeakFlowPage",props:{studyKey:String,taskId:Number},components:{},data:function(){return{isCompleted:!1,isMeasuring:!1,completedTests:0,totalTestsNumber:2,testErrors:0,maxErrors:4,measurement:void 0,PEFs:[],report:{userKey:n["a"].user._key,participantKey:n["a"].user.participantKey,studyKey:this.studyKey,taskId:parseInt(this.taskId),taskType:"peakFlow",createdTS:new Date,phone:o["a"].device,summary:{startedTS:new Date,completedTS:void 0,pefMax:void 0},data:{PEFs:void 0}}}},methods:{async startMeasurement(){if(this.completedTests<=this.totalTestsNumber){this.isMeasuring=!0;try{if(this.measurement=await i["a"].startMeasurement(),this.measurement.pef>1e3)throw new Error("PEF is too high");this.completedTests++,this.PEFs.push(this.measurement.pef)}catch(e){this.testErrors++,console.error(e),this.$q.notify({color:"negative",message:this.$t("studies.tasks.peakflow.measurementError"),icon:"report_problem"})}this.isMeasuring=!1}await i["a"].stopMeasurement()},completeTest(){this.report.summary.completedTS=new Date,this.report.summary.pefMax=Math.max(...this.PEFs),this.report.data={PEFs:this.PEFs},this.$router.push({name:"peakFlowSummary",params:{report:this.report}})},abandonTest(){this.$router.push({name:"tasker"})}},beforeDestroy:function(){i["a"].stopMeasurement()}},l=m,u=t("2877"),p=t("9989"),d=t("9c40"),c=t("eebe"),h=t.n(c),w=Object(u["a"])(l,r,a,!1,null,null,null);s["default"]=w.exports;h()(w,"components",{QPage:p["a"],QBtn:d["a"]})}}]);