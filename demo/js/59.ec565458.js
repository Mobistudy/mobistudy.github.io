(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[59],{7935:function(t,s,i){"use strict";i.r(s);var n=function(){var t=this,s=t._self._c;return s("q-page",{attrs:{padding:""}},[t.devices.length>1?s("div",{staticClass:"mobitxt2"},[t._v(t._s(t.$t("studies.tasks.po60.moreDevices")))]):t._e(),t.devices.length>1?s("q-list",{staticClass:"q-mt-md",attrs:{bordered:""}},t._l(t.devices,(function(i){return s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:i.id,attrs:{clickable:"",id:i.id},on:{click:function(s){return t.connect(i,!0)}}},[s("q-item-section",{staticClass:"mobitxt1"},[t._v(t._s(i.id))])],1)})),1):t._e(),s("q-dialog",{attrs:{"transition-show":"scale","transition-hide":"scale","no-esc-dismiss":"","no-backdrop-dismiss":""},model:{value:t.instructionDialog,callback:function(s){t.instructionDialog=s},expression:"instructionDialog"}},[s("q-card",[s("div",{staticClass:"q-pa-sm"}),s("q-card-section",[s("div",{staticClass:"row no-wrap items-center"},[s("div",{staticClass:"col text-body1"},[s("p",[t._v(t._s(t.$t("studies.tasks.po60.takeMeasurement")))])])])])],1)],1),s("q-inner-loading",{attrs:{showing:t.showScanning}},[s("div",{staticClass:"mobitxt2",attrs:{color:"dark-grey"}},[t._v(t._s(t.$t("studies.tasks.po60.scanning")))]),s("q-spinner-dots",{attrs:{size:"40px",color:"primary"}})],1),s("q-inner-loading",{attrs:{showing:t.showConnecting}},[s("div",{staticClass:"mobitxt2",attrs:{color:"dark-grey"}},[t._v(t._s(t.$t("studies.tasks.po60.connecting")))]),s("q-spinner-dots",{attrs:{size:"40px",color:"primary"}})],1)],1)},e=[],o=(i("14d9"),i("3fd3")),a=i("6a6d"),c={name:"PO60ConnectPage",props:{studyKey:String,taskId:Number},data(){return{devices:[],instructionDialog:!1,showScanning:!1,showConnecting:!1,connectionAttempts:0,maxConnectionAttempts:5}},methods:{async scan(){this.instructionDialog=!0;try{this.devices=await o["a"].scan(25e3),this.instructionDialog=!1,0===this.devices.length?this.$q.dialog({title:this.$t("studies.tasks.po60.noDeviceTitle"),message:this.$t("studies.tasks.po60.noDevice"),cancel:this.$t("common.cancel"),ok:this.$t("common.retry"),persistent:!0}).onOk((t=>{this.scan()})).onCancel((()=>{this.abandon()})):1===this.devices.length?this.connect(this.devices[0]):this.devices.sort(((t,s)=>s.rssi-t.rssi))}catch(t){this.instructionDialog=!1,console.error("Scan error",t),this.$q.dialog({title:this.$t("errors.error"),message:this.$t("studies.tasks.po60.scanFailed"),cancel:this.$t("common.cancel"),ok:this.$t("common.retry"),persistent:!0}).onOk((t=>{this.scan()})).onCancel((()=>{this.abandon()}))}},async connect(t,s){try{s?this.showConnecting=!0:(this.instructionDialog=!0,this.$q.platform.is.ios&&await o["a"].scanForId(t.id,5e3)),this.connectionAttempts++,await o["a"].connect(t),this.instructionDialog=!1,this.showConnecting=!1,t.authenticated=!0,await a["a"].setDevicePO60(t),this.moveToDownloadPage()}catch(i){console.error(i),this.connectionAttempts<this.maxConnectionAttempts?(console.log("Attempting connect again...",this.connectionAttempts),this.connect(t)):(this.connectionAttempts=0,this.instructionDialog=!1,this.$q.dialog({title:this.$t("errors.error"),message:this.$t("studies.tasks.po60.connectionFail"),cancel:this.$t("common.cancel"),ok:this.$t("common.retry"),persistent:!0}).onOk((async()=>{await o["a"].disconnect(),t.authenticated?this.connect(t):this.scan()})).onCancel((()=>{this.abandon()})))}},abandon(){try{o["a"].disconnect()}catch(t){console.error("cannot disconnect pulse oximeter",t)}this.$router.push({name:"tasker"})},moveToDownloadPage(){this.$router.push({name:"po60DataDownload",params:{studyKey:this.studyKey,taskId:this.taskId}})}},async mounted(){let t=await a["a"].getDevicePO60();t?this.connect(t):this.scan()}},r=c,d=i("2877"),l=i("9989"),h=i("1c1c"),m=i("66e5"),p=i("4074"),g=i("24e8"),u=i("f09f"),v=i("068f"),k=i("a370"),w=i("74f7"),y=i("8380"),$=i("714f"),D=i("eebe"),C=i.n(D),b=Object(d["a"])(r,n,e,!1,null,null,null);s["default"]=b.exports;C()(b,"components",{QPage:l["a"],QList:h["a"],QItem:m["a"],QItemSection:p["a"],QDialog:g["a"],QCard:u["a"],QImg:v["a"],QCardSection:k["a"],QInnerLoading:w["a"],QSpinnerDots:y["a"]}),C()(b,"directives",{Ripple:$["a"]})}}]);