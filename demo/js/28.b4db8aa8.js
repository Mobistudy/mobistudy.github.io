(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[28],{"906a":function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-page",{attrs:{padding:""}},[n("div",{staticClass:"text-h5 text-center"},[e._v("\n    "+e._s(e.$t("studies.consent.informedConsent"))+"\n  ")]),n("div",{staticClass:"text-body2"},[e._v("\n    "+e._s(e.$t("studies.consent.consentExplanation"))+"\n  ")]),n("consents",{attrs:{studyDescription:e.studyDescription,taskType:e.taskType,consentedExtraItems:e.consentedExtraItems,consentedTaskItems:e.consentedTaskItems,remindersPermissionGiven:e.remindersPermissionGiven,remindersPermissionNeeded:e.remindersPermissionNeeded},on:{checkboxReminders:e.requestNotificationsPermission}}),n("div",{staticClass:"q-my-md row justify-evenly"},[n("q-btn",{attrs:{label:e.$t("common.reject"),color:"negative",flat:""},on:{click:function(t){return e.deny()}}}),n("q-btn",{attrs:{label:e.$t("studies.consent.joinStudy"),color:"positive",disabled:!e.canAccept},on:{click:function(t){return e.accept()}}})],1)],1)},r=[],i=(n("7db0"),n("d81d"),n("96cf"),n("c973")),o=n.n(i),a=n("b6bd"),c=n("9bf1"),u=n("6a6d"),d=n("aa9c"),m=n("ee76"),p={name:"ConsentItemsPage",props:["studyDescription"],components:{Consents:a["a"]},data:function(){return{consentedExtraItems:[],consentedTaskItems:[],remindersPermissionNeeded:Boolean,remindersPermissionGiven:Boolean}},created:function(){var e=this;return o()(regeneratorRuntime.mark((function t(){var n,s,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,m["a"].hasPermission();case 2:if(n=t.sent,e.remindersPermissionNeeded=!n,e.remindersPermissionGiven=n,e.studyDescription.consent.extraItems&&e.studyDescription.consent.extraItems.length)for(s=0;s<e.studyDescription.consent.extraItems.length;s++)e.studyDescription.consent.extraItems[s].optional?e.consentedExtraItems.push(!1):e.consentedExtraItems.push(!0);for(r=0;r<e.studyDescription.consent.taskItems.length;r++)e.consentedTaskItems.push(!1);case 7:case"end":return t.stop()}}),t)})))()},computed:{taskType:function(){var e=this;return this.studyDescription.consent.taskItems.map((function(t){return e.studyDescription.tasks.find((function(e){return e.id===t.taskId})).type}))},canAccept:function(){for(var e=0;e<this.taskType.length;e++)if("dataQuery"===this.taskType[e]&&!this.consentedTaskItems[e])return!1;return!0}},methods:{accept:function(){var e=this;return o()(regeneratorRuntime.mark((function t(){var n,s,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,n={studyKey:e.studyDescription._key,currentStatus:"accepted",acceptedTS:new Date,reminders:e.remindersPermissionGiven,taskItemsConsent:[],extraItemsConsent:[]},e.studyDescription.consent.extraItems)for(s=0;s<e.studyDescription.consent.extraItems.length;s++)n.extraItemsConsent.push({consented:e.consentedExtraItems[s]});if(e.studyDescription.consent.taskItems)for(r=0;r<e.studyDescription.consent.taskItems.length;r++)n.taskItemsConsent.push({taskId:e.studyDescription.consent.taskItems[r].taskId,consented:e.consentedTaskItems[r]});return t.next=6,d["a"].updateStudyStatus(c["a"].user._key,e.studyDescription._key,n);case 6:return t.next=8,u["a"].getStudiesParticipation();case 8:return i=t.sent,i||(i=[]),i.push(n),t.next=13,u["a"].setStudiesParticipation(i);case 13:e.$router.push({name:"studies"}),t.next=20;break;case 16:t.prev=16,t.t0=t["catch"](0),console.error("Cannot join study",t.t0),e.$q.notify({color:"negative",message:e.$i18n.t("errors.connectionError")+": "+t.t0.message,icon:"report_problem"});case 20:e.$router.push({name:"accepted",params:{studyDescription:e.studyDescription}});case 21:case"end":return t.stop()}}),t,null,[[0,16]])})))()},deny:function(){var e=this;return o()(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$q.dialog({title:e.$i18n.t("studies.discardStudy"),message:e.$i18n.t("studies.discardStudyConfirm"),color:"primary",ok:e.$i18n.t("common.yes"),cancel:e.$i18n.t("common.cancel")}).onOk(o()(regeneratorRuntime.mark((function t(){var n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={studyKey:e.studyDescription._key,currentStatus:"rejected",rejectedTS:new Date},t.prev=1,t.next=4,d["a"].updateStudyStatus(c["a"].user._key,e.studyDescription._key,n);case 4:return t.next=6,u["a"].getStudiesParticipation();case 6:return s=t.sent,s||(s=[]),s.push(n),t.next=11,u["a"].setStudiesParticipation(s);case 11:e.$router.push({name:"studies"}),t.next=18;break;case 14:t.prev=14,t.t0=t["catch"](1),console.error("Cannot connect to server",t.t0),e.$q.notify({color:"negative",message:e.$i18n.t("errors.connectionError")+": "+t.t0.message,icon:"report_problem"});case 18:case"end":return t.stop()}}),t,null,[[1,14]])}))));case 1:case"end":return t.stop()}}),t)})))()},requestNotificationsPermission:function(e){var t=this;return o()(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!e){n.next=4;break}t.remindersPermissionGiven=!1,n.next=15;break;case 4:return n.prev=4,n.next=7,m["a"].requestPermission();case 7:t.remindersPermissionGiven=n.sent,t.$q.notify({color:"positive",message:t.$i18n.t("studies.consent.OSPermissionGiven"),icon:"check"}),n.next=15;break;case 11:n.prev=11,n.t0=n["catch"](4),console.error("Cannot get authorisation for sending reminders",n.t0),t.$q.notify({color:"negative",message:t.$i18n.t("studies.consent.OSPermissionNotGiven")+": "+n.t0.message,icon:"report_problem"});case 15:case"end":return n.stop()}}),n,null,[[4,11]])})))()}}},l=p,y=n("2877"),f=n("9989"),h=n("9c40"),k=n("eebe"),v=n.n(k),x=Object(y["a"])(l,s,r,!1,null,null,null);t["default"]=x.exports;v()(x,"components",{QPage:f["a"],QBtn:h["a"]})}}]);