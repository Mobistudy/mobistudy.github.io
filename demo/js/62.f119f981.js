(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[62],{"846b":function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e._self._c;return t("q-page",{attrs:{padding:""}},[t("q-inner-loading",{attrs:{showing:e.showConnecting}},[t("div",{staticClass:"mobitxt2",attrs:{color:"dark-grey"}},[e._v(e._s(e.$t("studies.tasks.position.connecting")))]),t("q-spinner-dots",{attrs:{size:"40px",color:"primary"}})],1),e.environment?t("div",{staticClass:"mobitxt1 text-center q-ma-lg"},[e.environment.weather&&e.environment.weather.location?t("div",{staticClass:"mobitxt1 q-my-lg"},[e._v(" "+e._s(e.$t("studies.tasks.position.approxLocation"))+": "+e._s(e.environment.weather.location))]):e._e(),t("table",{staticClass:"summaryTable q-my-lg"},[e.environment.weather&&e.environment.weather.icon?t("tr",[t("td",[e._v(e._s(e.$t("studies.tasks.position.weather")))]),t("td",[t("img",{attrs:{src:e.environment.weather.icon}})])]):e._e(),e.environment.weather&&e.environment.weather.temperature?t("tr",[t("td",[e._v(e._s(e.$t("studies.tasks.position.temperature")))]),t("td",[e._v(e._s(e.environment.weather.temperature.toFixed(0))+" Â°C")])]):e._e(),e.environment.weather&&e.environment.weather.humidity?t("tr",[t("td",[e._v(e._s(e.$t("studies.tasks.position.humidity")))]),t("td",[e._v(e._s(e.environment.weather.humidity.toFixed(0))+" %")])]):e._e(),e.environment.weather&&e.environment.weather.clouds?t("tr",[t("td",[e._v(e._s(e.$t("studies.tasks.position.clouds")))]),t("td",[e._v(e._s(e.environment.weather.clouds))])]):e._e(),e.environment.weather&&e.environment.weather.wind&&e.environment.weather.speed?t("tr",[t("td",[e._v(e._s(e.$t("studies.tasks.position.wind")))]),t("td",[e._v(e._s(e.environment.weather.wind.speed)+" m/s")])]):e._e(),e.aqiLevel?t("tr",[t("td",[e._v(e._s(e.$t("studies.tasks.position.airQuality"))+" ")]),t("td",[e._v(e._s(e.aqiLevel))])]):e._e(),e.environment.allergens&&e.environment.allergens.pollen&&e.environment.allergens.pollen.Risk&&e.environment.allergens.pollen.Risk.grass_pollen?t("tr",[t("td",[e._v(e._s(e.$t("studies.tasks.position.allergens.riskOfGrass"))+" ")]),t("td",[e._v(e._s(e.environment.allergens.pollen.Risk.grass_pollen))])]):e._e(),e.environment.allergens&&e.environment.allergens.pollen&&e.environment.allergens.pollen.Risk&&e.environment.allergens.pollen.Risk.tree_pollen?t("tr",[t("td",[e._v(e._s(e.$t("studies.tasks.position.allergens.riskOfTree"))+" ")]),t("td",[e._v(e._s(e.environment.allergens.pollen.Risk.tree_pollen))])]):e._e(),e.environment.allergens&&e.environment.allergens.pollen&&e.environment.allergens.pollen.Risk&&e.environment.allergens.pollen.Risk.weed_pollen?t("tr",[t("td",[e._v(e._s(e.$t("studies.tasks.position.allergens.riskOfWeed"))+" ")]),t("td",[e._v(e._s(e.environment.allergens.pollen.Risk.weed_pollen))])]):e._e()])]):e._e(),e.environment?t("div",{staticClass:"row justify-around q-mt-lg"},[t("q-btn",{staticClass:"mobibtn",attrs:{color:"negative",loading:e.sending,label:e.$t("common.discard")},on:{click:function(t){return e.discard()}}}),t("q-btn",{staticClass:"mobibtn",attrs:{color:"primary",loading:e.sending,label:e.$t("common.send")},on:{click:function(t){return e.send()}}})],1):e._e()],1)},i=[],o=(n("14d9"),n("a5f6")),r=n("9bf1"),a=n("c313"),l=n("6a6d"),d={name:"PositionPage",props:{studyKey:String,taskId:Number},data:function(){return{position:void 0,environment:void 0,showConnecting:!0,sending:!1,report:{userKey:r["a"].user._key,participantKey:r["a"].user.participantKey,studyKey:this.studyKey,taskId:parseInt(this.taskId),taskType:"position",createdTS:new Date,phone:o["a"].device,summary:{startedTS:new Date,completedTS:void 0,location:void 0},data:void 0}}},mounted:async function(){if(await o["a"].geolocation.isAvailable()){this.showConnecting=!0,this.position=await o["a"].geolocation.getCurrentPosition();try{this.environment=await a["a"].getEnvironmentFromPosition(this.position.coords.latitude,this.position.coords.longitude),this.report.summary.completedTS=new Date,this.report.summary.location=this.environment.weather.location,this.report.summary.weather=this.environment.weather.description,this.report.summary.temperature=this.environment.weather.temperature,this.report.summary.aqi=this.environment.pollution.aqi,this.report.data=this.environment,console.log(this.environment)}catch(e){console.error(e),this.$q.notify({color:"negative",message:this.$t("errors.connectionError")+" "+e.message,icon:"report_problem",timeout:0,actions:[{label:"Dismiss",color:"white",handler:()=>{this.$router.push("/home")}}]})}this.showConnecting=!1}else this.$q.notify({color:"negative",message:"No positioning available",icon:"report_problem",timeout:0,actions:[{label:"Dismiss",color:"white",handler:()=>{this.$router.push("/home")}}]})},methods:{async saveAndLeave(){try{console.log(this.report),await a["a"].sendTasksResults(this.report),await l["a"].setTaskCompletion(this.report.studyKey,this.report.taskId,new Date),this.$router.push({name:"home"})}catch(e){this.sending=!1,console.error(e),this.$q.notify({color:"negative",message:this.$t("errors.connectionError")+" "+e.message,icon:"report_problem"})}},async send(){return this.sending=!0,this.report.discarded=!1,this.saveAndLeave()},async discard(){return this.sending=!0,this.report.discarded=!0,delete this.report.summary,delete this.report.data,this.saveAndLeave()}},computed:{aqiLevel(){return this.environment.pollution&&this.environment.pollution.aqi?this.$t("studies.tasks.position.aqiscale.l"+this.environment.pollution.aqi):void 0}}},m=d,p=n("2877"),v=n("9989"),c=n("74f7"),h=n("8380"),u=n("9c40"),g=n("eebe"),_=n.n(g),w=Object(p["a"])(m,s,i,!1,null,null,null);t["default"]=w.exports;_()(w,"components",{QPage:v["a"],QInnerLoading:c["a"],QSpinnerDots:h["a"],QBtn:u["a"]})}}]);