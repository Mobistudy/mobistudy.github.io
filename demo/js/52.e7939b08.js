(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[52],{"08ed":function(t,s,e){"use strict";e.r(s);var i=function(){var t=this,s=t._self._c;return s("div",{staticClass:"q-pa-md"},[t.devices.length>1?s("div",[t._v(t._s(t.$t("studies.tasks.miband3.moreDevices")))]):t._e(),t.devices.length>1?s("q-list",{staticClass:"q-mt-md",attrs:{bordered:""}},t._l(t.devices,(function(e){return s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:e.id,attrs:{clickable:"",id:e.id},on:{click:function(s){return t.connect(e)}}},[s("q-item-section",[t._v(t._s(e.id))])],1)})),1):t._e(),s("q-dialog",{attrs:{"transition-show":"scale","transition-hide":"scale","no-esc-dismiss":"","no-backdrop-dismiss":""},model:{value:t.tapToAuthDialog,callback:function(s){t.tapToAuthDialog=s},expression:"tapToAuthDialog"}},[s("q-card",[s("div",{staticClass:"q-pa-sm"},[s("q-img",{attrs:{src:"instructions/miband3_tap.svg"}})],1),s("q-card-section",[s("div",{staticClass:"row no-wrap items-center"},[s("div",{staticClass:"col text-h6 ellipsis"},[t._v("\n            "+t._s(t.$t("studies.tasks.miband3.tap"))+"\n          ")])])])],1)],1),s("q-inner-loading",{attrs:{showing:t.showSearching}},[s("div",{staticClass:"text-overline",attrs:{color:"dark-grey"}},[t._v(t._s(t.$t("studies.tasks.miband3.searching")))]),s("q-spinner-dots",{attrs:{size:"40px",color:"primary"}})],1),s("q-inner-loading",{attrs:{showing:t.showConnecting}},[s("div",{staticClass:"text-overline",attrs:{color:"dark-grey"}},[t._v(t._s(t.$t("studies.tasks.miband3.connecting")))]),s("q-spinner-dots",{attrs:{size:"40px",color:"primary"}})],1)],1)},a=[],n=(e("14d9"),e("e995")),o=e("6a6d"),c=e("9bf1"),r={name:"Miband3ConnectPage",props:{studyKey:String,taskId:Number},data(){return{devices:[],tapToAuthDialog:!1,showSearching:!1,showConnecting:!1,connectionAttempts:0,maxConnectionAttempts:5}},methods:{async search(){this.devices=[],this.showSearching=!0;try{this.devices=await n["a"].search(12e3),0===this.devices.length?this.$q.dialog({title:this.$t("studies.tasks.miband3.noDeviceTitle"),message:this.$t("studies.tasks.miband3.noDevice"),cancel:this.$t("common.cancel"),ok:this.$t("common.retry"),persistent:!0}).onOk((t=>{this.search()})).onCancel((()=>{this.abandon()})):1===this.devices.length?this.connect(this.devices[0]):this.devices.sort(((t,s)=>s.rssi-t.rssi))}catch(t){console.error("Search error",t),this.$q.dialog({title:this.$t("errors.error"),message:this.$t("studies.tasks.miband3.searchFailed"),cancel:this.$t("common.cancel"),ok:this.$t("common.retry"),persistent:!0}).onOk((t=>{this.search()})).onCancel((()=>{this.abandon()}))}this.showSearching=!1},async connect(t){this.showConnecting=!0;try{this.$q.platform.is.ios&&await n["a"].searchForId(t.id,12e3),this.connectionAttempts++,await n["a"].connect(t),t.authenticated||(this.tapToAuthDialog=!0),await n["a"].authenticate(t.authenticated);let s=c["a"].user;const e=await o["a"].getTaskDescription(this.studyKey,this.taskId);await n["a"].configure(s,e.hrInterval),this.tapToAuthDialog=!1,this.showConnecting=!1,t.authenticated=!0,await o["a"].setDeviceMiBand3(t),this.moveToDownloadPage()}catch(s){console.error(s),this.showConnecting=!1,this.connectionAttempts<this.maxConnectionAttempts?(console.log("Attempting connect again...",this.connectionAttempts),this.connect(t)):this.$q.dialog({title:this.$t("errors.error"),message:this.$t("studies.tasks.miband3.connectionFail"),cancel:this.$t("common.cancel"),ok:this.$t("common.retry"),persistent:!0}).onOk((async()=>{try{await n["a"].disconnect()}catch(s){console.log(s)}console.log("Error:",s),t.authenticated?this.connect(t):this.search()})).onCancel((()=>{this.abandon()}))}},abandon(){try{n["a"].disconnect()}catch(t){console.error("cannot disconnect miband3",t)}this.$router.push({name:"tasker"})},moveToDownloadPage(){this.$router.push({name:"miband3DataDownload",params:{studyKey:this.studyKey,taskId:this.taskId}})}},async mounted(){let t=await o["a"].getDeviceMiBand3();t?this.connect(t):this.search()}},h=r,d=e("2877"),l=e("1c1c"),m=e("66e5"),g=e("4074"),p=e("24e8"),u=e("f09f"),v=e("068f"),w=e("a370"),k=e("74f7"),b=e("8380"),y=e("714f"),$=e("eebe"),C=e.n($),q=Object(d["a"])(h,i,a,!1,null,null,null);s["default"]=q.exports;C()(q,"components",{QList:l["a"],QItem:m["a"],QItemSection:g["a"],QDialog:p["a"],QCard:u["a"],QImg:v["a"],QCardSection:w["a"],QInnerLoading:k["a"],QSpinnerDots:b["a"]}),C()(q,"directives",{Ripple:y["a"]})}}]);