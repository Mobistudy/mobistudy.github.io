(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{"9e71":function(e,t,n){"use strict";n("9eb4")},"9eb4":function(e,t,n){},a726:function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-page",{attrs:{padding:""}},[n("div",{staticClass:"text-center text-h5 q-mt-lg"},[e._v("\n    "+e._s(e.$t("studies.tasks.qcst.title"))+"\n  ")]),n("p",{attrs:{id:"timer"}},[e._v(" "+e._s(e.minutes)+":"+e._s(e.seconds)+" ")]),n("div",{staticClass:"row justify-center q-mt-lg"},[e.isStarted?e._e():n("q-btn",{attrs:{color:"secondary",label:e.$t("common.start"),padding:"lg"},on:{click:e.startTest}}),e.isStarted?n("q-btn",{attrs:{color:"purple",label:e.$t("common.complete"),padding:"lg"},on:{click:e.completeTest}}):e._e()],1),e.isStarted?n("q-btn",{ref:"metronome_indicator",staticClass:"q-mt-xl",attrs:{padding:"xl",color:"black",round:"",flat:"",icon:"volume_up"}}):e._e()],1)},s=[],i=(n("a9e3"),n("96cf"),n("c973")),r=n.n(i),a=n("efed"),c={metronome:{metronomeID:null,audioContext:null,nextNoteTime:0,currentQuarterNote:0,volume:.2,scheduleBeeping:function(e,t){var n=this.audioContext.createOscillator(),o=this.audioContext.createGain();n.frequency.value=e%4===0?1e3:800,o.gain.value=this.volume,o.gain.exponentialRampToValueAtTime(this.volume,t+.001),o.gain.exponentialRampToValueAtTime(.001,t+.02),n.connect(o),o.connect(this.audioContext.destination),n.start(t),n.stop(t+.03)},nextBeep:function(e){var t=625===e?96:88,n=60/t;this.nextNoteTime+=n,this.currentQuarterNote++,4===this.currentQuarterNote&&(this.currentQuarterNote=0)},start:function(e,t){var n=this,o=window.AudioContext||window.webkitAudioContext;this.audioContext=new o,this.currentQuarterNote=0,this.nextNoteTime=this.audioContext.currentTime+.05,this.metronomeID=setInterval((function(){while(n.nextNoteTime<n.audioContext.currentTime+.1)n.scheduleBeeping(n.currentQuarterNote,n.nextNoteTime),n.nextBeep(e),t.click()}),25)},stop:function(){clearInterval(this.metronomeID),console.log("Stopping metronome")}},media:{playSound:function(e){if(void 0!==e){var t=new Audio(e.currentSrc);t.play()}}},textToSpeech:{speech:null,language:null,volume:1,playVoice:function(e){"speechSynthesis"in window?(this.speech=new SpeechSynthesisUtterance,this.speech.volume=this.volume,this.speech.text=e,this.speech.lang=this.language,console.log(this.speech),null!==this.speech&&window.speechSynthesis.speak(this.speech)):console.log("Text-to-speech is not supported on this device")}}},u=n("9bf1"),l=n("7937"),p=180,d={name:"QCSTPage",props:{studyKey:String,taskId:Number},components:{},data:function(){return{isStarted:!1,isCompleted:!1,timer:null,countDown:p,startedTS:void 0,completionTS:void 0,steps:[],gender:u["a"].user.gender,heartRate:"",cadence:"male"===u["a"].user.gender?625:681}},methods:{startTest:function(){var e=this;return r()(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.isStarted){t.next=15;break}return e.isStarted=!0,e.startedTS=new Date,c.textToSpeech.language=u["a"].user.language,t.next=6,a["a"].pedometer.isAvailable();case 6:if(!t.sent){t.next=10;break}a["a"].pedometer.startNotifications({},function(){var t=r()(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log("Steps",n),e.steps.push(n);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),(function(e){console.error("Error getting steps",e)})),t.next=11;break;case 10:console.error("Pedometer not available");case 11:c.textToSpeech.playVoice(e.$i18n.t("studies.tasks.qcst.begin")),e.timer=setInterval((function(){120===e.countDown?c.textToSpeech.playVoice(e.$i18n.t("studies.tasks.qcst.twoMin")):60===e.countDown&&c.textToSpeech.playVoice(e.$i18n.t("studies.tasks.qcst.oneMin")),e.countDown>=1?e.countDown--:(e.isStarted=!1,e.completeTest())}),1e3),c.metronome.start(e.cadence,e.$refs.metronome_indicator.$el),e.$emit("updateTransition","slideInRight");case 15:case"end":return t.stop()}}),t)})))()},completeTest:function(){c.textToSpeech.playVoice(this.$i18n.t("studies.tasks.qcst.time")),a["a"].pedometer.stopNotifications(),this.completionTS=new Date;var e=this.studyKey,t=parseInt(this.taskId),n=u["a"].user._key,o={userKey:n,studyKey:e,taskId:t,createdTS:new Date,startedTS:this.startedTS,completionTS:this.completionTS,steps:this.steps,heartRate:void 0,borgScale:void 0};this.$router.push({name:"qcsthr",params:{report:o}})}},computed:{minutes:function(){return l["c"].pad(Math.floor(this.countDown/60),2)},seconds:function(){return l["c"].pad(this.countDown-60*this.minutes,2)}},beforeDestroy:function(){this.isStarted=!1,clearInterval(this.timer),c.metronome.stop(),a["a"].pedometer.stopNotifications()}},m=d,h=(n("9e71"),n("2877")),f=n("9989"),g=n("9c40"),w=n("eebe"),x=n.n(w),v=Object(h["a"])(m,o,s,!1,null,"0b039b36",null);t["default"]=v.exports;x()(v,"components",{QPage:f["a"],QBtn:g["a"]})}}]);