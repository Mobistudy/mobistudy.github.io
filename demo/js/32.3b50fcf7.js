(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[32],{"4d6a":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("q-page",{attrs:{padding:""}},[t._l(t.newStudies,(function(e,s){return i("q-card",{key:s,staticClass:"q-mb-md",attrs:{bordered:""}},[i("q-card-section",[i("div",{staticClass:"row no-wrap"},[i("div",{staticClass:"col"},[i("div",{staticClass:"text-h6"},[t._v(t._s(t.$t("studies.newStudyInvite")))]),i("div",{staticClass:"text-subtitle1"},[t._v(t._s(e.generalities.title[t.$i18n.locale]))]),i("div",{staticClass:"text-subtitle2"},[t._v(t._s(e.generalities.shortDescription[t.$i18n.locale]))])])])]),e.inclusionCriteria.criteriaQuestions&&e.inclusionCriteria.criteriaQuestions.length>0?i("q-card-section",[t._v("\n      "+t._s(t.$t("studies.newStudyExtraCriteria"))+":\n      "),t._l(e.inclusionCriteria.criteriaQuestions,(function(e,a){return i("div",{key:a},[i("p",{staticClass:"q-mt-md text-subtitle2"},[t._v(t._s(e.title[t.$i18n.locale]))]),i("div",{staticClass:"row"},[i("q-radio",{staticClass:"col",attrs:{val:"yes",label:t.$t("common.yes")},model:{value:t.newStudiesCustomAnswers[s][a],callback:function(e){t.$set(t.newStudiesCustomAnswers[s],a,e)},expression:"newStudiesCustomAnswers[studyIndex][questionIndex]"}}),i("q-radio",{staticClass:"col",attrs:{val:"no",label:t.$t("common.no")},model:{value:t.newStudiesCustomAnswers[s][a],callback:function(e){t.$set(t.newStudiesCustomAnswers[s],a,e)},expression:"newStudiesCustomAnswers[studyIndex][questionIndex]"}})],1)])}))],2):t._e(),i("q-separator"),i("div",{staticClass:"q-ma-sm text-negative",attrs:{color:"negative"}},[i("span",{directives:[{name:"show",rawName:"v-show",value:!t.eligible[s]&&t.newStudiesCustomAnswers[s].length===e.inclusionCriteria.criteriaQuestions.length,expression:"!eligible[studyIndex] && newStudiesCustomAnswers[studyIndex].length === study.inclusionCriteria.criteriaQuestions.length"}]},[t._v("\n        "+t._s(t.$t("studies.notEligible"))+"\n      ")])]),i("q-card-actions",{attrs:{align:"around"}},[i("q-btn",{attrs:{flat:"",color:"negative",label:t.$t("studies.discardStudy")},on:{click:function(e){return t.discardStudy(s)}}}),i("q-btn",{attrs:{color:"primary",label:t.$t("studies.joinStudy"),disable:!t.eligible[s]},on:{click:function(e){return t.joinStudy(s)}}})],1)],1)})),i("q-list",{attrs:{separator:"",bordered:""}},[i("q-item-label",{attrs:{header:""}},[t._v(t._s(t.$t("studies.activeStudies")))]),t._l(t.activeStudies,(function(e,s){return i("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:"as"+s,attrs:{clickable:""},nativeOn:{click:function(i){return t.showDetails(e)}}},[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{color:"primary",name:"settings"}})],1),i("q-item-section",[i("q-item-label",[t._v(t._s(e.generalities.title[t.$i18n.locale]))]),i("q-item-label",{attrs:{caption:"",lines:"1"}},[t._v("End Date: "+t._s(t.nicerDate(e.generalities.endDate)))])],1)],1)})),0===t.activeStudies.length?i("q-item",[i("q-item-section",[t._v(t._s(t.$t("studies.noActiveStudies")))])],1):t._e(),0!==t.previousStudies.length?i("q-separator"):t._e(),0!==t.previousStudies.length?i("q-item-label",{attrs:{header:""}},[t._v(t._s(t.$t("studies.previousStudies")))]):t._e(),t._l(t.previousStudies,(function(e,s){return i("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:"ps"+s,attrs:{clickable:""},nativeOn:{click:function(i){return t.showDetails(e)}}},[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{color:"primary",name:"settings"}})],1),i("q-item-section",[i("q-item-label",[t._v(t._s(e.generalities.title[t.$i18n.locale]))])],1)],1)}))],2),t.pageLoaded?i("q-page-sticky",{attrs:{position:"bottom-right",offset:[18,18]}},[i("q-btn",{attrs:{fab:"",icon:"add",color:"accent"},on:{click:t.showInvitationDialog}})],1):t._e()],2)},a=[],n=(i("a434"),i("e6cf"),i("ddb0"),i("9bf1")),r=i("6a6d"),o=i("c313"),c=i("bd4c"),u={name:"Studies",data(){return{newStudies:[],newStudiesCustomAnswers:[],activeStudies:[],previousStudies:[],pageLoaded:!1}},async created(){this.$q.loading.show();try{let t=await o["a"].getNewStudiesKeys();for(let i=0;i<t.length;i++){let e=t[i],s=await o["a"].getStudyDescription(e);this.newStudiesCustomAnswers.push([]),this.newStudies.push(s)}let e=await r["a"].getStudiesParticipation();if(e)for(let i of e)if("accepted"===i.currentStatus){let t=await r["a"].getStudyDescription(i.studyKey);this.activeStudies.push(t)}else if("withdrawn"===i.currentStatus||"completed"===i.currentStatus){let t=await r["a"].getStudyDescription(i.studyKey);this.previousStudies.push(t)}}catch(t){console.error("Cannot connect to server",t),this.$q.notify({color:"negative",message:this.$i18n.t("errors.connectionError")+": "+t.message,icon:"report_problem"})}this.$q.loading.hide(),this.pageLoaded=!0},computed:{eligible(){let t=[];for(let e=0;e<this.newStudies.length;e++){let i=this.newStudies[e];if(i.inclusionCriteria.criteriaQuestions&&0!==i.inclusionCriteria.criteriaQuestions.length){let s=!0;for(let t=0;t<i.inclusionCriteria.criteriaQuestions.length;t++)if(i.inclusionCriteria.criteriaQuestions[t].answer!==this.newStudiesCustomAnswers[e][t]){s=!1;break}t.push(s)}else t.push(!0)}return t}},methods:{nicerDate(t){return c["b"].formatDate(t,"YYYY/MM/DD")},showDetails(t){this.$router.push({name:"studyConfig",params:{studyDescription:t}})},async discardStudy(t){this.$q.dialog({title:this.$i18n.t("studies.discardStudy"),message:this.$i18n.t("studies.discardStudyConfirm"),color:"primary",ok:this.$i18n.t("common.yes"),cancel:this.$i18n.t("common.cancel")}).onOk((async()=>{let e=this.newStudies[t],i={studyKey:e._key};this.eligible[t]||this.newStudiesCustomAnswers[t].length!==e.inclusionCriteria.criteriaQuestions.length?(i.currentStatus="rejected",i.rejectedTS=new Date):(i.currentStatus="excluded",i.excludedTS=new Date,i.criteriaAnswers=this.newStudiesCustomAnswers[t]);try{await o["a"].updateStudyStatus(n["a"].user._key,e._key,i);let s=await r["a"].getStudiesParticipation();s||(s=[]),s.push(i),await r["a"].setStudiesParticipation(s),this.newStudies.splice(t,1),this.newStudiesCustomAnswers.splice(t,1),this.$router.push({name:"tasker"})}catch(s){console.error("Cannot connect to server",s),this.$q.notify({color:"negative",message:this.$i18n.t("errors.connectionError")+": "+s.message,icon:"report_problem"})}}))},async joinStudy(t){let e=this.newStudies[t];this.$router.push({name:"invitation",params:{studyDescription:e}})},async showInvitationDialog(){try{this.$q.dialog({title:"New study",message:"Paste your invitation code here",color:"primary",ok:!0,cancel:!0,prompt:{model:"",type:"text"}}).onOk((t=>{this.addInvitationalStudy(t)}))}catch(t){}},async addInvitationalStudy(t){let e;try{e=await o["a"].getInvitationalStudy(t)}catch(i){return console.error("Error:",i),void(i.response&&i.response.status&&404===i.response.status?this.$q.notify({color:"negative",message:this.$i18n.t("errors.invitationalStudyNotFound"),icon:"report_problem"}):this.$q.notify({color:"negative",message:this.$i18n.t("errors.connectionError"),icon:"report_problem"}))}this.studyExists(this.newStudies,e)?this.$q.notify({color:"negative",message:this.$i18n.t("errors.invitationalStudyAlreadyAdded"),icon:"report_problem"}):await this.alreadyParticipateInStudy(e._key)?this.$q.notify({color:"negative",message:this.$i18n.t("errors.invitationalStudyAlreadyParticipated"),icon:"report_problem"}):(this.newStudiesCustomAnswers.push([]),this.newStudies.push(e))},async alreadyParticipateInStudy(t){const e=await r["a"].getStudyParticipation(t);return!!e},studyExists(t,e){let i=!1;return t.find((t=>{t._key===e._key&&(i=!0)})),i}}},l=u,d=i("2877"),p=i("9989"),h=i("f09f"),m=i("a370"),y=i("3786"),w=i("eb85"),S=i("4b7e"),v=i("9c40"),g=i("1c1c"),b=i("0170"),_=i("66e5"),q=i("4074"),C=i("0016"),f=i("de5e"),$=i("714f"),k=i("eebe"),Q=i.n(k),x=Object(d["a"])(l,s,a,!1,null,null,null);e["default"]=x.exports;Q()(x,"components",{QPage:p["a"],QCard:h["a"],QCardSection:m["a"],QRadio:y["a"],QSeparator:w["a"],QCardActions:S["a"],QBtn:v["a"],QList:g["a"],QItemLabel:b["a"],QItem:_["a"],QItemSection:q["a"],QIcon:C["a"],QPageSticky:f["a"]}),Q()(x,"directives",{Ripple:$["a"]})}}]);