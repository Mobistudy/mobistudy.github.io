(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{"5b54":function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-page",{attrs:{padding:""}},[n("q-pull-to-refresh",{attrs:{label:"Default spinner"},on:{refresh:t.refresh}},[t.newstudies?n("q-banner",{staticClass:"bg-warning text-white q-mb-sm",attrs:{rounded:"","inline-actions":"",icon:"new_releases",type:"warning"},scopedSlots:t._u([{key:"action",fn:function(){return[n("q-btn",{attrs:{color:"blue",label:t.$t("studies.checkNewStusy"),to:"studies"}})]},proxy:!0}],null,!1,845094109)},[t._v("\n      "+t._s(t.$t("studies.newStudy"))+"!\n      ")]):t._e(),t.nostudies?n("div",{staticClass:"q-title"},[t._v(t._s(t.$t("studies.noStudies")))]):n("q-list",{attrs:{highlight:""}},[n("q-item-label",{attrs:{header:""}},[t._v("\n        "+t._s(t.$t("studies.tasks.pendingTasks"))+"\n      ")]),n("div",t._l(t.tasks.upcoming,(function(t,e){return n("taskListItem",{key:e,attrs:{task:t}})})),1),0===t.tasks.upcoming.length?n("q-item",[n("q-item-section",{attrs:{avatar:""}},[n("q-icon",{attrs:{color:"primary",name:"check"}})],1),n("q-item-section",[n("q-item-label",[t._v(t._s(t.$t("studies.tasks.noPendingTasks")))])],1)],1):t._e(),n("q-separator",{attrs:{inset:""}}),n("q-item-label",{attrs:{header:""}},[t._v("\n        "+t._s(t.$t("studies.tasks.missedTasks"))+"\n      ")]),n("div",t._l(t.tasks.missed,(function(t,e){return n("taskListItem",{key:e,attrs:{task:t}})})),1),0===t.tasks.missed.length?n("q-item",[n("q-item-section",{attrs:{avatar:""}},[n("q-icon",{attrs:{color:"primary",name:"check"}})],1),n("q-item-section",[n("q-item-label",[t._v(t._s(t.$t("studies.tasks.noMissedTasks")))])],1)],1):t._e()],1)],1),this.tasks.completedStudyAlert?n("q-dialog",{attrs:{maximized:""},model:{value:t.completedStudyModal,callback:function(e){t.completedStudyModal=e},expression:"completedStudyModal"}},[n("div",{staticClass:"q-pa-lg text-center",staticStyle:{"background-color":"white"}},[n("div",{staticClass:"text-h4 q-mb-md"},[t._v(t._s(t.$t("studies.studyCompletedHeadline"))+"!")]),n("div",[n("img",{staticStyle:{width:"30vw","max-width":"150px"},attrs:{src:"statics/icons/confetti.svg"}})]),n("p",{domProps:{innerHTML:t._s(t.$t("studies.studyCompletedText",{studyname:t.completedStudyTitle}))}}),n("q-btn",{attrs:{color:"primary",label:t.$t("common.close")},on:{click:function(e){return t.studyCompleted()}}})],1)]):t._e()],1)},r=[],a=(n("ac6a"),n("ac4d"),n("8a81"),n("5df3"),n("1c4c"),n("7f7f"),n("6b54"),n("06db"),n("967e")),i=n.n(a),o=(n("96cf"),n("fa84")),u=n.n(o),c=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-item",{nativeOn:{click:function(e){return t.changeRoute(e)}}},[n("q-item-section",{attrs:{avatar:""}},[n("q-icon",{attrs:{color:"grey",name:t.icon}})],1),n("q-item-section",[n("q-item-label",[t._v(t._s(t.title))]),n("q-item-label",{attrs:{caption:""}},[t._v(t._s(t.main))])],1),n("q-item-section",{attrs:{side:"",top:""}},[t._v(t._s(t.timeRemaining))])],1)},d=[],l=n("c1df"),h=n.n(l),f={name:"TaskListItem",props:["task"],data:function(){return{icon:void 0,title:void 0,main:void 0}},methods:{changeRoute:function(){var t=this.task.type,e=this.task.studyKey,n=this.task.taskId,s=this.task.formKey;if(s)this.$router.push({name:"form",params:{studyKey:e,taskId:n,formKey:s},query:{icon:this.icon,title:this.title}});else if("smwt"===t)this.$router.push({name:"smwtIntro",params:{studyKey:e,taskId:n},query:{icon:this.icon,title:this.title}});else if("qcst"===t)this.$router.push({name:"qcstIntro",params:{studyKey:e,taskId:n},query:{icon:this.icon,title:this.title}});else if("miband3"===t)this.$router.push({name:"miband3Intro",params:{studyKey:e,taskId:n},query:{icon:this.icon,title:this.title}});else{if(!e||!n)return!1;this.$router.push({name:"dataQuery",params:{taskId:n,studyKey:e},query:{icon:this.icon,title:this.title}})}}},created:function(){"dataQuery"===this.task.type?(this.title=this.$i18n.t("studies.tasks.dataQuery.shortTitle"),this.main=this.$i18n.t("studies.tasks.dataQuery.shortDescription"),this.icon="insert_chart_outlined"):"form"===this.task.type?(this.title=this.task.formTitle[this.$root.$i18n.locale],this.main=this.$i18n.t("studies.tasks.form.shortDescription"),this.icon="format_list_bulleted"):"smwt"===this.task.type?(this.title=this.$i18n.t("studies.tasks.smwt.shortTitle"),this.main=this.$i18n.t("studies.tasks.smwt.shortDescription"),this.icon="directions_walk"):"qcst"===this.task.type?(this.title=this.$i18n.t("studies.tasks.qcst.shortTitle"),this.main=this.$i18n.t("studies.tasks.qcst.shortDescription"),this.icon="layers"):"miband3"===this.task.type&&(this.title=this.$i18n.t("studies.tasks.miband3.shortTitle"),this.main=this.$i18n.t("studies.tasks.miband3.shortDescription"),this.icon="watch")},computed:{timeRemaining:function(){return"Due "+h()(this.task.due).fromNow()}}},p=f,m=n("2877"),y=n("66e5"),k=n("4074"),v=n("0016"),b=n("0170"),g=n("eebe"),w=n.n(g),S=Object(m["a"])(p,c,d,!1,null,null,null),x=S.exports;w()(S,"components",{QItem:y["a"],QItemSection:k["a"],QIcon:v["a"],QItemLabel:b["a"]});var q=n("9bf1"),$=n("6a6d"),_=n("aa9c"),I=(n("f751"),n("7514"),n("8847")),D=n("55b4"),T=n("ee76"),O=n("0967"),A=n("1e59");function C(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=Q(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var s=0,r=function(){};return{s:r,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,o=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return i=t.done,t},e:function(t){o=!0,a=t},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw a}}}}function Q(t,e){if(t){if("string"===typeof t)return K(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?K(t,e):void 0}}function K(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,s=new Array(e);n<e;n++)s[n]=t[n];return s}function E(t,e){var n,s={upcoming:[],missed:[]},r=C(t);try{var a=function(){var t=n.value;if("accepted"===t.currentStatus){var r,a=e.find((function(e){return e._key===t.studyKey})),i=a.tasks.filter((function(e){var n=t.taskItemsConsent.find((function(t){return t.taskId===e.id}));return n.consented})),o=!0,u=C(i);try{var c=function(){var e=r.value,n=new Date(a.generalities.endDate),i=L(t.acceptedTS,n,e.scheduling),u=i.between(l().startOf("day").toDate(),n);if(!(u.length>0))return"continue";if(o=!1,"dataQuery"===e.type){if(O["b"].is.ios&&A["a"].isAndroidOnly(e.dataType))return"continue";if(O["b"].is.android&&A["a"].isIOSOnly(e.dataType))return"continue"}var c=void 0,d=void 0;if(t.taskItemsConsent){var h=t.taskItemsConsent.find((function(t){return t.taskId===e.id}));h&&h.lastExecuted&&(d=l(new Date(h.lastExecuted)))}d?(c=i.between(d.toDate(),l().startOf("day").toDate()),c=c.length>0?c[c.length-1]:null):c=i.before(l().startOf("day").toDate());var f=void 0;d&&d.isAfter(l().startOf("day"))?f=null:(f=i.between(l().startOf("day").toDate(),l().endOf("day").toDate()),f=f.length>0?f[0]:null);var p={type:e.type,studyKey:a._key,taskId:e.id};"form"===e.type&&(p.formTitle=e.formName,p.formKey=e.formKey),null!==f?s.upcoming.push(Object.assign({missed:!1,due:f},p)):null!==c&&s.missed.push(Object.assign({missed:!0,due:c},p))};for(u.s();!(r=u.n()).done;)c()}catch(d){u.e(d)}finally{u.f()}o&&(s.completedStudyAlert={studyTitle:a.generalities.title,studyPart:t})}};for(r.s();!(n=r.n()).done;)a()}catch(i){r.e(i)}finally{r.f()}return s}function L(t,e,n){var s=l(t);if("consent"!==n.startEvent)throw new Error("The only start event recognised is consent");n.startDelaySecs&&(s=s.clone().add(n.startDelaySecs,"s"));var r,a=l(e);if(n.untilSecs){var i=s.clone().add(n.untilSecs,"s");i.isBefore(a)&&(a=i.clone())}switch(n.intervalType){case"y":r=D["a"].YEARLY;break;case"m":r=D["a"].MONTHLY;break;case"w":r=D["a"].WEEKLY;break;case"d":r=D["a"].DAILY;break;default:throw new Error("No Frequency Specified")}var o=[];if(n.weekDays)for(var u=0;u<n.weekDays.length;u++)switch(n.weekDays[u]){case"mo":o.push(D["a"].MO);break;case"tu":o.push(D["a"].TU);break;case"we":o.push(D["a"].WE);break;case"th":o.push(D["a"].TH);break;case"fr":o.push(D["a"].FR);break;case"sa":o.push(D["a"].SA);break;case"su":o.push(D["a"].SU);break}var c={};return c.dtstart=s.toDate(),c.until=a.toDate(),c.freq=r,n.interval&&(c.interval=n.interval),n.months&&(c.bymonth=n.months),n.monthDays&&(c.bymonthday=n.monthDays),c.byweekday=o,n.occurrences&&(c.count=n.occurrences),new D["a"](c)}function M(){return P.apply(this,arguments)}function P(){return P=u()(i.a.mark((function t(){return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",T["a"].cancelAll());case 1:case"end":return t.stop()}}),t)}))),P.apply(this,arguments)}function j(t,e,n){return N.apply(this,arguments)}function N(){return N=u()(i.a.mark((function t(e,n,s){var r,a,o,u,c,d;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=[],a=[],o=C(n.tasks),t.prev=3,c=function(){var t=u.value;if("dataQuery"===t.type){if(O["b"].is.ios&&A["a"].isAndroidOnly(t.dataType))return"continue";if(O["b"].is.android&&A["a"].isIOSOnly(t.dataType))return"continue"}for(var i=L(e,new Date(n.generalities.endDate),t.scheduling),o=i.between(new Date,new Date(n.generalities.endDate),!0),c=0;c<o.length&&c<1e3;c++){var d=o[c],h=l(d).startOf("minute").toDate(),f="";if(n._key){var p=n._key.toString();f+=p.slice(-4)}f+=t.id,f+=c;var m=void 0;if(s.taskItemsConsent){var y=s.taskItemsConsent.find((function(e){return e.taskId===t.id}));y&&y.lastExecuted&&(m=l(new Date(y.lastExecuted)))}var k=!1;m&&l(h).isBetween(l().startOf("day"),l().endOf("day"))&&m.isBetween(l().startOf("day"),l(h))&&(k=!0),-1!==a.indexOf(l(h).unix())||k||(a.push(l(h).unix()),r.push({id:parseInt(f),title:I["b"].t("studies.scheduling.due"),text:I["b"].t("studies.scheduling.start"),foreground:!0,trigger:{at:h}}))}},o.s();case 6:if((u=o.n()).done){t.next=12;break}if(d=c(),"continue"!==d){t.next=10;break}return t.abrupt("continue",10);case 10:t.next=6;break;case 12:t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](3),o.e(t.t0);case 17:return t.prev=17,o.f(),t.finish(17);case 20:return t.next=22,T["a"].schedule(r);case 22:case"end":return t.stop()}}),t,null,[[3,14,17,20]])}))),N.apply(this,arguments)}function R(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=F(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var s=0,r=function(){};return{s:r,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,o=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return i=t.done,t},e:function(t){o=!0,a=t},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw a}}}}function F(t,e){if(t){if("string"===typeof t)return B(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?B(t,e):void 0}}function B(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,s=new Array(e);n<e;n++)s[n]=t[n];return s}var Y={name:"TaskerPage",components:{taskListItem:x},props:["rescheduleTasks","checkNewStudies"],data:function(){return{nostudies:!1,newstudies:!1,tasks:{upcoming:[],missed:[],completedStudyAlert:void 0,completedStudyTitle:void 0},completedStudyModal:!1}},created:function(){var t=this;return u()(i.a.mark((function e(){return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.load();case 1:case"end":return e.stop()}}),e)})))()},methods:{refresh:function(t){var e=this,n=this.$q.notify({group:!1,spinner:!0,type:"ongoing",message:this.$i18n.t("studies.searchingForStudies")+"...",timeout:0});setTimeout((function(){e.checkForStudy(),t(),n({type:e.newstudies?"positive":"warning",spinner:!1,message:e.newstudies?e.$i18n.t("studies.newStudyInvite"):e.$i18n.t("studies.foundNoStudies"),timeout:1e3}),e.loading=!1}),1e3)},checkForStudy:function(){var t=this;return u()(i.a.mark((function e(){var n;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.checkNewStudies){e.next=11;break}return e.prev=1,e.next=4,_["a"].getNewStudiesKeys();case 4:n=e.sent,n.length>0?t.newstudies=!0:t.newstudies=!1,e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](1),console.error("Cannot connect to server, but thats OK",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})))()},load:function(){var t=this;return u()(i.a.mark((function e(){var n,s,r,a,o,u,c,d,l;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.$q.loading.show(),e.prev=1,t.checkForStudy(),!t.rescheduleTasks){e.next=25;break}return e.next=6,M();case 6:return e.prev=6,e.next=9,_["a"].getProfile(q["a"].user._key);case 9:if(n=e.sent,n.studies&&0!==n.studies.length){e.next=18;break}return e.next=13,$["a"].setStudiesParticipation([]);case 13:return t.$q.loading.hide(),t.nostudies=!0,e.abrupt("return");case 18:return e.next=20,$["a"].setStudiesParticipation(n.studies);case 20:e.next=25;break;case 22:e.prev=22,e.t0=e["catch"](6),console.error("Cannot connect to server, but thats OK",e.t0);case 25:return e.next=27,$["a"].getStudiesParticipation();case 27:if(s=e.sent,s){e.next=32;break}return t.$q.loading.hide(),t.nostudies=!0,e.abrupt("return");case 32:r=[],a=[],o=R(s),e.prev=35,o.s();case 37:if((u=o.n()).done){e.next=57;break}return c=u.value,e.next=41,$["a"].getStudyDescription(c.studyKey);case 41:if(d=e.sent,d){e.next=51;break}return e.next=45,_["a"].getStudyDescription(c.studyKey);case 45:return d=e.sent,e.next=48,$["a"].setStudyDescription(c.studyKey,d);case 48:if("accepted"!==c.currentStatus||t.rescheduleTasks||!c.reminders){e.next=51;break}return e.next=51,j(new Date(c.acceptedTS),d,c);case 51:if("accepted"!==c.currentStatus||!t.rescheduleTasks||!c.reminders){e.next=54;break}return e.next=54,j(new Date(c.acceptedTS),d,c);case 54:"accepted"===c.currentStatus&&(r.push(c),a.push(d));case 55:e.next=37;break;case 57:e.next=62;break;case 59:e.prev=59,e.t1=e["catch"](35),o.e(e.t1);case 62:return e.prev=62,o.f(),e.finish(62);case 65:if(0!==a.length){e.next=69;break}return t.$q.loading.hide(),t.nostudies=!0,e.abrupt("return");case 69:l=E(r,a),t.tasks=l,l.completedStudyAlert&&(t.completedStudyTitle=l.completedStudyAlert.studyTitle[t.$root.$i18n.locale],t.completedStudyModal=!0),t.$q.loading.hide(),e.next=80;break;case 75:e.prev=75,e.t2=e["catch"](1),console.error(e.t2),t.$q.loading.hide(),t.$q.dialog({title:t.$i18n.t("errors.error"),message:t.$i18n.t("errors.generalError"),color:"warning",ok:t.$i18n.t("common.retry"),preventClose:!0}).onOk((function(){console.log("retry"),t.load()}));case 80:case"end":return e.stop()}}),e,null,[[1,75],[6,22],[35,59,62,65]])})))()},studyCompleted:function(){var t=this;return u()(i.a.mark((function e(){var n;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.tasks.completedStudyAlert.studyPart,n.currentStatus="completed",n.completedTS=new Date,e.prev=3,e.next=6,_["a"].updateStudyStatus(q["a"].user._key,n.studyKey,n);case 6:return delete n.extraItemsConsent,delete n.taskItemsConsent,e.next=10,$["a"].setStudyParticipation(n);case 10:t.load(),t.completedStudyModal=!1,e.next=18;break;case 14:e.prev=14,e.t0=e["catch"](3),console.error("Cannot set the study as completed",e.t0),t.$q.notify({color:"negative",message:t.$i18n.t("errors.connectionError")+": "+e.t0.message,icon:"report_problem"});case 18:case"end":return e.stop()}}),e,null,[[3,14]])})))()}}},H=Y,U=n("9989"),J=n("59d7"),W=n("54e1"),z=n("9c40"),G=n("1c1c"),V=n("eb85"),X=n("24e8"),Z=Object(m["a"])(H,s,r,!1,null,"5e8ecc81",null);e["default"]=Z.exports;w()(Z,"components",{QPage:U["a"],QPullToRefresh:J["a"],QBanner:W["a"],QBtn:z["a"],QList:G["a"],QItemLabel:b["a"],QItem:y["a"],QItemSection:k["a"],QIcon:v["a"],QSeparator:V["a"],QDialog:X["a"]})}}]);