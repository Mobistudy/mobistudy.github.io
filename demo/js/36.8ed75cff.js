(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[36],{"0c3b":function(t,a,e){"use strict";e.r(a);var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("q-page",{attrs:{padding:""}},[t.chartData?e("div",[e("p",{staticStyle:{"margin-top":"0"}},[t._v(t._s(t.$t("studies.tasks.dataQuery.dataQueryExplanation")))]),t.plotBar?e("bar-chart",{attrs:{"chart-data":t.chartData,options:t.chartOptions}}):t._e(),t.plotLine?e("line-chart",{attrs:{"chart-data":t.chartData,options:t.chartOptions}}):t._e(),e("div",{staticClass:"row justify-around"},[e("q-btn",{attrs:{color:"secondary",loading:t.loading,label:t.$t("common.discard")},on:{click:function(a){return t.discard()}}}),e("q-btn",{attrs:{color:"primary",loading:t.loading,label:t.$t("common.send")},on:{click:function(a){return t.submit()}}})],1)],1):t._e()])},n=[],r=(e("99af"),e("7db0"),e("c975"),e("a9e3"),e("96cf"),e("c973")),o=e.n(r),c=e("4468"),i=e("1fca"),l={extends:i["a"],props:["chartData","options"],mounted:function(){this.renderChart(this.chartData,this.options)}},u={extends:i["b"],props:["chartData","options"],mounted:function(){this.renderChart(this.chartData,this.options)}},d=e("9bf1"),h=e("6a6d"),p=e("aa9c"),D=e("1e59"),k=e("c1df"),g=e.n(k),b=["#800000","#778000","#118000","#008080","#003780","#080080","#440080","#790080","#800046","#800046"],m={name:"DataQueryPage",props:{studyKey:String,taskId:Number},components:{BarChart:l,LineChart:u},data:function(){return{task:{},taskDescr:{},chartData:null,chartOptions:null,healthData:null,plotLine:!1,plotBar:!1,loading:!1}},mounted:function(){var t=this;return o()(regeneratorRuntime.mark((function a(){var e,s,n,r,o,i,l,u,d,p,k,m,y,f,v,x,T,w,A;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.$q.loading.show(),e=t.studyKey,s=t.taskId,a.next=5,h["a"].getStudyDescription(e);case 5:return n=a.sent,t.taskDescr=n.tasks.find((function(t){return t.id===Number(s)})),a.next=9,h["a"].getStudyParticipation(e);case 9:if(r=a.sent,o=r.taskItemsConsent.find((function(t){return t.taskId===Number(s)})).lastExecuted,i=g()(),"undefined"!==typeof o?i=g()(o):"d"===t.taskDescr.scheduling.intervalType?i.subtract(t.taskDescr.scheduling.interval,"days"):"w"===t.taskDescr.scheduling.intervalType?i.subtract(t.taskDescr.scheduling.interval,"weeks"):"m"===t.taskDescr.scheduling.intervalType?i.subtract(t.taskDescr.scheduling.interval,"months"):"y"===t.taskDescr.scheduling.intervalType&&i.subtract(t.taskDescr.scheduling.interval,"years"),console.log("Retrieving ".concat(t.taskDescr.dataType,", aggregated: ").concat(t.taskDescr.aggregated,", bucket: ").concat(t.taskDescr.bucket)),console.log("Start Date: "+i.toDate()),a.prev=15,!t.taskDescr.aggregated){a.next=28;break}if(!t.taskDescr.bucket||"none"===t.taskDescr.bucket){a.next=23;break}return a.next=20,c["a"].queryAggregated({startDate:i.toDate(),endDate:new Date,dataType:D["a"].toNativeType(t.taskDescr.dataType),bucket:t.taskDescr.bucket});case 20:t.healthData=a.sent,a.next=26;break;case 23:return a.next=25,c["a"].queryAggregated({startDate:i.toDate(),endDate:new Date,dataType:D["a"].toNativeType(t.taskDescr.dataType)});case 25:t.healthData=a.sent;case 26:a.next=31;break;case 28:return a.next=30,c["a"].query({startDate:i.toDate(),endDate:new Date,dataType:D["a"].toNativeType(t.taskDescr.dataType)});case 30:t.healthData=a.sent;case 31:if(console.log("raw health data",t.healthData),l="",t.taskDescr.bucket&&"none"!==t.taskDescr.bucket?l=t.taskDescr.bucket:t.healthData.unit?l=t.healthData.unit:t.healthData.length&&(l=t.healthData[0].unit),u={labels:[],datasets:[]},t.taskDescr.aggregated){if(t.taskDescr.bucket&&"none"!==t.taskDescr.bucket)if("activity"===t.taskDescr.dataType){for(d=[],p=0;p<t.healthData.length;p++)for(k in u.labels.push(t.healthData[p].endDate),t.healthData[p].value)m=d.indexOf(k),m<0&&(m=u.datasets.length,d.push(k),u.datasets.push({label:k,data:[],backgroundColor:b[m]})),y=parseInt(t.healthData[p].value[k].duration/36e5),u.datasets[m].data.push(y);t.chartOptions={maintainAspectRatio:!1,scales:{yAxes:[{stacked:!0,ticks:{beginAtZero:!0}}],xAxes:[{stacked:!0,type:"time",bounds:"data",time:{unit:l}}]}}}else{for(u.datasets.push({label:t.$i18n.t("healthDataTypes."+t.taskDescr.dataType),data:[],backgroundColor:"#800000"}),f=0;f<t.healthData.length;f++)u.labels.push(t.healthData[f].endDate),u.datasets[0].data.push(t.healthData[f].value);t.chartOptions={maintainAspectRatio:!1,scales:{yAxes:[{ticks:{beginAtZero:!0}}],xAxes:[{type:"time",bounds:"data",time:{unit:l}}]}}}else if("activity"===t.taskDescr.dataType){for(x in v=[],u.labels.push(g()(t.healthData.startDate).format("D/M/YY HH:mm")+" to "+g()(t.healthData.endDate).format("D/M/YY HH:mm")),t.healthData.value)T=v.indexOf(x),T<0&&(T=u.datasets.length,v.push(x),u.datasets.push({label:x,data:[],backgroundColor:b[T]})),w=parseInt(t.healthData.value[x].duration/36e5),u.datasets[T].data.push(w);t.chartOptions={maintainAspectRatio:!1,scales:{yAxes:[{stacked:!0,ticks:{beginAtZero:!0}}],xAxes:[{stacked:!0}]}}}else u.datasets.push({label:t.$i18n.t("healthDataTypes."+t.taskDescr.dataType),data:[],backgroundColor:"#800000"}),u.labels.push(g()(t.healthData.startDate).format("D/M/YY HH:mm")+" to "+g()(t.healthData.endDate).format("D/M/YY HH:mm")),u.datasets[0].data.push(t.healthData.value),t.chartOptions={maintainAspectRatio:!1,scales:{yAxes:[{ticks:{beginAtZero:!0}}]}};t.plotBar=!0}else{for(u.datasets.push({label:t.$i18n.t("healthDataTypes."+t.taskDescr.dataType),data:[],fill:!1,pointRadius:0,lineTension:0,backgroundColor:"#800000",borderColor:"rgba(128,0,0,0.66)"}),A=0;A<t.healthData.length;A++)u.labels.push(t.healthData[A].endDate),u.datasets[0].data.push(t.healthData[A].value);t.chartOptions={maintainAspectRatio:!1,scales:{yAxes:[{ticks:{beginAtZero:!0}}],xAxes:[{type:"time",bounds:"data"}]}},t.plotLine=!0}t.chartData=u,t.$q.loading.hide(),a.next=45;break;case 40:a.prev=40,a.t0=a["catch"](15),console.error(a.t0),t.$q.loading.hide(),t.$q.notify({color:"negative",message:"Cannot retrieve data: "+a.t0.message,icon:"report_problem"});case 45:case"end":return a.stop()}}),a,null,[[15,40]])})))()},methods:{submit:function(){var t=this;return o()(regeneratorRuntime.mark((function a(){var e,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.loading=!0,a.prev=1,e=t.studyKey,s=Number(t.taskId),a.next=6,p["a"].sendDataQuery({userKey:d["a"].user._key,studyKey:e,taskId:s,dataType:t.taskDescr.dataType,createdTS:new Date,healthData:t.healthData});case 6:return a.next=8,h["a"].setTaskCompletion(e,s,new Date);case 8:t.$router.push("/home"),a.next=16;break;case 11:a.prev=11,a.t0=a["catch"](1),t.loading=!1,console.error(a.t0),t.$q.notify({color:"negative",message:t.$t("errors.connectionError")+" "+a.t0.message,icon:"report_problem",onDismiss:function(){this.$router.push("/home")}});case 16:case"end":return a.stop()}}),a,null,[[1,11]])})))()},discard:function(){var t=this;return o()(regeneratorRuntime.mark((function a(){var e,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e=t.studyKey,s=Number(t.taskId),a.next=4,h["a"].setTaskCompletion(e,s,new Date);case 4:t.$router.push("/home");case 5:case"end":return a.stop()}}),a)})))()}}},y=m,f=e("2877"),v=e("9989"),x=e("9c40"),T=e("eebe"),w=e.n(T),A=Object(f["a"])(y,s,n,!1,null,null,null);a["default"]=A.exports;w()(A,"components",{QPage:v["a"],QBtn:x["a"]})}}]);