(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[39],{"08ed":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"q-pa-md"},[e.devices.length>1?n("div",[e._v(e._s(e.$t("studies.tasks.miband3.moreDevices")))]):e._e(),e.devices.length>1?n("q-list",{staticClass:"q-mt-md",attrs:{bordered:""}},e._l(e.devices,(function(t){return n("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:t.id,attrs:{clickable:"",id:t.id},on:{click:function(n){return e.connect(t)}}},[n("q-item-section",[e._v(e._s(t.id))])],1)})),1):e._e(),n("q-dialog",{attrs:{"transition-show":"scale","transition-hide":"scale","no-esc-dismiss":"","no-backdrop-dismiss":""},model:{value:e.tapToAuthDialog,callback:function(t){e.tapToAuthDialog=t},expression:"tapToAuthDialog"}},[n("q-card",[n("div",{staticClass:"q-pa-sm"},[n("q-img",{attrs:{src:"instructions/miband3_tap.png"}})],1),n("q-card-section",[n("div",{staticClass:"\n          row\n          no-wrap\n          items-center"},[n("div",{staticClass:"col text-h6 ellipsis"},[e._v("\n            "+e._s(e.$t("studies.tasks.miband3.tap"))+"\n          ")])])])],1)],1),n("q-inner-loading",{attrs:{showing:e.showSearching}},[n("div",{staticClass:"text-overline",attrs:{color:"dark-grey"}},[e._v(e._s(e.$t("studies.tasks.miband3.searching")))]),n("q-spinner-dots",{attrs:{size:"40px",color:"primary"}})],1),n("q-inner-loading",{attrs:{showing:e.showConnecting}},[n("div",{staticClass:"text-overline",attrs:{color:"dark-grey"}},[e._v(e._s(e.$t("studies.tasks.miband3.connecting")))]),n("q-spinner-dots",{attrs:{size:"40px",color:"primary"}})],1)],1)},s=[],r=(n("a9e3"),n("ac1f"),n("841c"),n("96cf"),n("c973")),c=n.n(r),i=n("e995"),o=n("6a6d"),d=n("9bf1"),u={name:"Miband3ConnectPage",props:{studyKey:String,taskId:Number},data:function(){return{devices:[],tapToAuthDialog:!1,showSearching:!1,showConnecting:!1,connectionAttempts:0,maxConnectionAttempts:5}},methods:{search:function(){var e=this;return c()(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.devices=[],e.showSearching=!0,t.prev=2,t.next=5,i["a"].search(12e3);case 5:e.devices=t.sent,0===e.devices.length?e.$q.dialog({title:e.$t("studies.tasks.miband3.noDeviceTitle"),message:e.$t("studies.tasks.miband3.noDevice"),cancel:e.$t("common.cancel"),ok:e.$t("common.retry"),persistent:!0}).onOk((function(t){e.search()})).onCancel((function(){e.abandon()})):1===e.devices.length?e.connect(e.devices[0]):e.devices.sort((function(e,t){return t.rssi-e.rssi})),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](2),console.error("Search error",t.t0),e.$q.dialog({title:e.$t("errors.error"),message:e.$t("studies.tasks.miband3.searchFailed"),cancel:e.$t("common.cancel"),ok:e.$t("common.retry"),persistent:!0}).onOk((function(t){e.search()})).onCancel((function(){e.abandon()}));case 13:e.showSearching=!1;case 14:case"end":return t.stop()}}),t,null,[[2,9]])})))()},connect:function(e){var t=this;return c()(regeneratorRuntime.mark((function n(){var a,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.showConnecting=!0,n.prev=1,!t.$q.platform.is.ios){n.next=5;break}return n.next=5,i["a"].searchForId(e.id,12e3);case 5:return t.connectionAttempts++,n.next=8,i["a"].connect(e);case 8:return e.authenticated||(t.tapToAuthDialog=!0),n.next=11,i["a"].authenticate(e.authenticated);case 11:return a=d["a"].user,n.next=14,o["a"].getTaskDescription(t.studyKey,t.taskId);case 14:return s=n.sent,n.next=17,i["a"].configure(a,s.hrInterval);case 17:return t.tapToAuthDialog=!1,t.showConnecting=!1,e.authenticated=!0,n.next=22,o["a"].setDeviceMiBand3(e);case 22:t.moveToDownloadPage(),n.next=30;break;case 25:n.prev=25,n.t0=n["catch"](1),console.error(n.t0),t.showConnecting=!1,t.connectionAttempts<t.maxConnectionAttempts?(console.log("Attempting connect again...",t.connectionAttempts),t.connect(e)):t.$q.dialog({title:t.$t("errors.error"),message:t.$t("studies.tasks.miband3.connectionFail"),cancel:t.$t("common.cancel"),ok:t.$t("common.retry"),persistent:!0}).onOk(c()(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,i["a"].disconnect();case 3:a.next=8;break;case 5:a.prev=5,a.t0=a["catch"](0),console.log(a.t0);case 8:console.log("Error:",n.t0),e.authenticated?t.connect(e):t.search();case 10:case"end":return a.stop()}}),a,null,[[0,5]])})))).onCancel((function(){t.abandon()}));case 30:case"end":return n.stop()}}),n,null,[[1,25]])})))()},abandon:function(){try{i["a"].disconnect()}catch(e){console.error("cannot disconnect miband3",e)}this.$router.push({name:"tasker",params:{rescheduleTasks:!0}})},moveToDownloadPage:function(){this.$router.push({name:"miband3DataDownload",params:{studyKey:this.studyKey,taskId:this.taskId}})}},mounted:function(){var e=this;return c()(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o["a"].getDeviceMiBand3();case 2:n=t.sent,n?e.connect(n):e.search();case 4:case"end":return t.stop()}}),t)})))()}},l=u,m=n("2877"),p=n("1c1c"),h=n("66e5"),g=n("4074"),v=n("24e8"),f=n("f09f"),k=n("068f"),w=n("a370"),b=n("74f7"),x=n("8380"),$=n("714f"),C=n("eebe"),q=n.n(C),D=Object(m["a"])(l,a,s,!1,null,null,null);t["default"]=D.exports;q()(D,"components",{QList:p["a"],QItem:h["a"],QItemSection:g["a"],QDialog:v["a"],QCard:f["a"],QImg:k["a"],QCardSection:w["a"],QInnerLoading:b["a"],QSpinnerDots:x["a"]}),q()(D,"directives",{Ripple:$["a"]})}}]);