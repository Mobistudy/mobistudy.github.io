(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[44],{"87da":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-page",{attrs:{id:"main"}},[n("div",{staticClass:"flex col text-center justify-center"},[n("div",{staticClass:"q-pa-md"},[n("h6",[e._v(e._s(e.$t("studies.tasks.po60.dataHRTitle")))]),n("q-circular-progress",{attrs:{"show-value":"",indeterminate:e.isDownloading,value:void 0!==e.storedData?100:0,size:"80px",thickness:.2,color:"blue","center-color":"blue-1","track-color":"transparent"}},[e._v("\n        "+e._s(e.avgHR)+"\n      ")])],1),n("div",{staticClass:"q-pa-md"},[n("h6",[e._v(e._s(e.$t("studies.tasks.po60.dataSPO2Title")))]),n("q-circular-progress",{attrs:{"show-value":"",indeterminate:e.isDownloading,value:void 0!==e.storedData?100:0,size:"80px",thickness:.2,color:"blue","center-color":"blue-1","track-color":"transparent"}},[e._v("\n        "+e._s(e.avgSPO2)+"\n      ")])],1)]),n("div",{staticClass:"q-my-md row justify-around fixed-bottom"},[n("q-btn",{attrs:{label:e.$t("common.skip"),flat:"",color:"negative"},on:{click:function(t){return e.skipSend()}}}),n("q-btn",{attrs:{label:e.$t("common.send"),color:"primary"},on:{click:function(t){return e.sendData()}}})],1),n("q-inner-loading",{attrs:{showing:e.isSending}},[n("div",{staticClass:"text-overline"},[e._v(e._s(e.$t("studies.tasks.po60.dataSending")))]),n("q-spinner-oval",{attrs:{size:"50px",color:"primary"}})],1)],1)},a=[],s=(n("a9e3"),n("d3b7"),n("e6cf"),n("96cf"),n("c973")),o=n.n(s),i=n("3fd3"),c=n("6a6d"),u=n("9bf1"),d=n("aa9c"),l={props:{studyKey:String,taskId:Number},data:function(){return{isDownloading:!1,isSending:!1,storedData:void 0,avgHR:"",avgSPO2:""}},watch:{storedData:function(e){this.avgHR=e.hrAvg+"",this.avgSPO2=e.SPO2Avg+"%"}},methods:{downloadData:function(){var e=this;return o()(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isDownloading=!0,t.next=3,e.delay(1);case 3:return t.prev=3,t.next=6,i["a"].getLatestData();case 6:return e.storedData=t.sent,t.prev=7,t.next=10,i["a"].disconnect();case 10:t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](7),console.error("cannot disconnect PO60",t.t0);case 15:t.next=21;break;case 17:t.prev=17,t.t1=t["catch"](3),console.error("cannot download data",t.t1),e.showErrorDialog();case 21:e.isDownloading=!1;case 22:case"end":return t.stop()}}),t,null,[[3,17],[7,12]])})))()},showErrorDialog:function(){var e=this;this.$q.dialog({title:this.$t("errors.error"),message:this.$t("studies.tasks.po60.dataDownloadError"),cancel:this.$t("common.cancel"),ok:this.$t("common.retry"),persistent:!0}).onOk((function(){e.$router.push({name:"po60Intro",params:{studyKey:e.studyKey,taskId:e.taskId}})})).onCancel((function(){e.cancelTask()}))},cancelTask:function(){var e=this;return o()(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,i["a"].disconnect();case 3:t.next=8;break;case 5:t.prev=5,t.t0=t["catch"](0),console.error("cannot disconnect po60",t.t0);case 8:e.$router.push({name:"tasker"});case 9:case"end":return t.stop()}}),t,null,[[0,5]])})))()},skipSend:function(){var e=this;return o()(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.studyKey,r=Number(e.taskId),t.next=4,c["a"].setTaskCompletion(n,r,new Date);case 4:e.$router.push("/home");case 5:case"end":return t.stop()}}),t)})))()},sendData:function(){var e=this;return o()(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isSending=!0,t.next=3,e.delay(2);case 3:return t.prev=3,n=e.studyKey,r=Number(e.taskId),t.next=8,d["a"].sendPO60Data({userKey:u["a"].user._key,studyKey:n,taskId:r,createdTS:new Date,device:e.deviceInfo,po60Data:e.storedData});case 8:return t.next=10,c["a"].setTaskCompletion(n,r,new Date);case 10:e.isSending=!1,e.$router.push("/home"),t.next=19;break;case 14:t.prev=14,t.t0=t["catch"](3),e.isSending=!1,console.error(t.t0),e.$q.notify({color:"negative",message:e.$t("errors.connectionError")+" "+t.t0.message,icon:"report_problem",onDismiss:function(){this.$router.push("/home")}});case 19:case"end":return t.stop()}}),t,null,[[3,14]])})))()},delay:function(e){return o()(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){setTimeout((function(){t()}),1e3*e)})));case 1:case"end":return t.stop()}}),t)})))()}},mounted:function(){var e=this;return o()(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.downloadData();case 2:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){return o()(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i["a"].disconnect();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e["catch"](0),console.error("cannot disconnect miband3",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})))()}},p=l,m=n("2877"),v=n("9989"),h=n("58ea"),g=n("9c40"),f=n("74f7"),w=n("1b41"),k=n("eebe"),x=n.n(k),b=Object(m["a"])(p,r,a,!1,null,null,null);t["default"]=b.exports;x()(b,"components",{QPage:v["a"],QCircularProgress:h["a"],QBtn:g["a"],QInnerLoading:f["a"],QSpinnerOval:w["a"]})}}]);