(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[54],{"846b":function(e,t,s){"use strict";s.r(t);var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-page",{attrs:{padding:""}},[s("q-inner-loading",{attrs:{showing:e.showConnecting}},[s("div",{staticClass:"text-overline",attrs:{color:"dark-grey"}},[e._v(e._s(e.$t("studies.tasks.position.connecting")))]),s("q-spinner-dots",{attrs:{size:"40px",color:"primary"}})],1),e.environment?s("p",{staticClass:"text-subtitle2 text-center "},[e._v("\n  "+e._s(e.$t("studies.tasks.position.approxLocation"))+": "+e._s(e.environment.weather.location)),s("br"),s("img",{attrs:{src:e.environment.weather.icon}}),s("br"),e._v("\n    "+e._s(e.$t("studies.tasks.position.weather"))+": "+e._s(e.environment.weather.description)+" "),s("br"),e._v("\n    "+e._s(e.$t("studies.tasks.position.temperature"))+": "+e._s(e.environment.weather.temperature.toFixed(0))+" Â°C "),s("br"),e._v("\n    "+e._s(e.$t("studies.tasks.position.humidity"))+": "+e._s(e.environment.weather.humidity.toFixed(0))+" % "),s("br"),e._v("\n    "+e._s(e.$t("studies.tasks.position.clouds"))+": "+e._s(e.environment.weather.clouds)+" % "),s("br"),e._v("\n    "+e._s(e.$t("studies.tasks.position.wind"))+": "+e._s(e.environment.weather.wind.speed)+" m/s "),s("br"),e._v("\n    "+e._s(e.$t("studies.tasks.position.airQuality"))+" : "+e._s(e.aqiLevel)),s("br"),e._v("\n    "+e._s(e.$t("studies.tasks.position.allergens.riskOfGrass"))+": "+e._s(e.environment.allergens.pollen.Risk.grass_pollen)+" "),s("br"),e._v("\n    "+e._s(e.$t("studies.tasks.position.allergens.riskOfTree"))+": "+e._s(e.environment.allergens.pollen.Risk.tree_pollen)+" "),s("br"),e._v("\n    "+e._s(e.$t("studies.tasks.position.allergens.riskOfWeed"))+": "+e._s(e.environment.allergens.pollen.Risk.weed_pollen)+"\n  ")]):e._e(),e.environment?s("div",{staticClass:"row justify-around"},[s("q-btn",{attrs:{color:"secondary",loading:e.sending,label:e.$t("common.discard")},on:{click:function(t){return e.discard()}}}),s("q-btn",{attrs:{color:"primary",loading:e.sending,label:e.$t("common.send")},on:{click:function(t){return e.send()}}})],1):e._e()],1)},i=[],o=s("efed"),r=s("9bf1"),a=s("c313"),l=s("6a6d"),d={name:"PositionPage",props:{studyKey:String,taskId:Number},data:function(){return{position:void 0,environment:void 0,showConnecting:!0,sending:!1}},mounted:async function(){if(await o["a"].geolocation.isAvailable()){this.showConnecting=!0,this.position=await o["a"].geolocation.getCurrentPosition();try{this.environment=await a["a"].getEnvironmentFromPosition(this.position.coords.latitude,this.position.coords.longitude),console.log(this.environment)}catch(e){console.error(e),this.$q.notify({color:"negative",message:this.$t("errors.connectionError")+" "+e.message,icon:"report_problem",timeout:0,actions:[{label:"Dismiss",color:"white",handler:()=>{this.$router.push("/home")}}]})}this.showConnecting=!1}else this.$q.notify({color:"negative",message:"No positioning available",icon:"report_problem",timeout:0,actions:[{label:"Dismiss",color:"white",handler:()=>{this.$router.push("/home")}}]})},methods:{async send(){this.sending=!0;const e=this.studyKey,t=parseInt(this.taskId),s=r["a"].user._key;let n={userKey:s,studyKey:e,taskId:t,createdTS:new Date,position:this.position,environment:this.environment};try{await a["a"].sendPosition(n),await l["a"].setTaskCompletion(e,t,new Date),this.$q.loading.hide(),this.$router.push("/home")}catch(i){this.$q.loading.hide(),console.error(i),this.$q.notify({color:"negative",message:this.$t("errors.connectionError")+" "+i.message,icon:"report_problem"}),this.sending=!1}},async discard(){this.sending=!0;const e=this.studyKey,t=parseInt(this.taskId),s=r["a"].user._key;try{await a["a"].sendPosition({userKey:s,studyKey:e,taskId:t,createdTS:new Date,position:"discarded",environment:"discarded"}),await l["a"].setTaskCompletion(e,t,new Date),this.$router.push({name:"home"})}catch(n){this.sending=!1,console.error(n),this.$q.notify({color:"negative",message:this.$t("errors.connectionError")+" "+n.message,icon:"report_problem"})}}},computed:{aqiLevel(){return this.$t("studies.tasks.position.aqiscale.l"+this.environment.pollution.aqi)}}},c=d,h=s("2877"),p=s("9989"),u=s("74f7"),m=s("8380"),g=s("9c40"),v=s("eebe"),_=s.n(v),w=Object(h["a"])(c,n,i,!1,null,null,null);t["default"]=w.exports;_()(w,"components",{QPage:p["a"],QInnerLoading:u["a"],QSpinnerDots:m["a"],QBtn:g["a"]})}}]);