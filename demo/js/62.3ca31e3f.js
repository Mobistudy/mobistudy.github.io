(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[62],{"87da":function(t,s,a){"use strict";a.r(s);var e=function(){var t=this,s=t._self._c;return s("q-page",{attrs:{id:"main"}},[s("div",{staticClass:"flex col text-center justify-center"},[s("div",{staticClass:"q-pa-md"},[s("h6",[t._v(t._s(t.$t("studies.tasks.po60.dataHRTitle")))]),s("q-circular-progress",{attrs:{"show-value":"",indeterminate:t.isDownloading,value:void 0!==t.storedData?100:0,size:"80px",thickness:.2,color:"blue","center-color":"blue-1","track-color":"transparent"}},[t._v("\n        "+t._s(t.avgHR)+"\n      ")])],1),s("div",{staticClass:"q-pa-md"},[s("h6",[t._v(t._s(t.$t("studies.tasks.po60.dataSPO2Title")))]),s("q-circular-progress",{attrs:{"show-value":"",indeterminate:t.isDownloading,value:void 0!==t.storedData?100:0,size:"80px",thickness:.2,color:"blue","center-color":"blue-1","track-color":"transparent"}},[t._v("\n        "+t._s(t.avgSPO2)+"\n      ")])],1)]),s("div",{staticClass:"row justify-around q-mt-lg"},[s("q-btn",{attrs:{color:"secondary",loading:t.sending,label:t.$t("common.discard")},on:{click:function(s){return t.discard()}}}),s("q-btn",{attrs:{color:"primary",loading:t.sending,label:t.$t("common.send")},on:{click:function(s){return t.send()}}})],1)])},o=[],n=(a("14d9"),a("3fd3")),r=a("6a6d"),i=a("9bf1"),c=a("c313"),d=a("a5f6"),l={props:{studyKey:String,taskId:Number},data(){return{isDownloading:!1,isSending:!1,storedData:void 0,avgHR:"",avgSPO2:"",sending:!1}},watch:{storedData:function(t){this.avgHR=t.hrAvg+"",this.avgSPO2=t.SPO2Avg+"%"}},methods:{async downloadData(){this.isDownloading=!0;try{this.storedData=await n["a"].getLatestData();try{await n["a"].disconnect()}catch(t){console.error("cannot disconnect PO60",t)}}catch(t){console.error("cannot download data",t),this.showErrorDialog()}this.isDownloading=!1},showErrorDialog(){this.$q.dialog({title:this.$t("errors.error"),message:this.$t("studies.tasks.po60.dataDownloadError"),cancel:this.$t("common.cancel"),ok:this.$t("common.retry"),persistent:!0}).onOk((()=>{this.$router.push({name:"po60Intro",params:{studyKey:this.studyKey,taskId:this.taskId}})})).onCancel((()=>{this.cancelTask()}))},async cancelTask(){try{await n["a"].disconnect()}catch(t){console.error("cannot disconnect po60",t)}this.$router.push({name:"tasker"})},async send(){this.isSending=!0;try{let t=this.studyKey,s=Number(this.taskId);await c["a"].sendPO60Data({userKey:i["a"].user._key,studyKey:t,taskId:s,createdTS:new Date,device:this.deviceInfo,po60Data:this.storedData}),await r["a"].setTaskCompletion(t,s,new Date),this.isSending=!1,this.$router.push("/home")}catch(t){this.isSending=!1,console.error(t),this.$q.notify({color:"negative",message:this.$t("errors.connectionError")+" "+t.message,icon:"report_problem",onDismiss(){this.$router.push("/home")}})}},async discard(){let t=this.studyKey,s=Number(this.taskId);this.isSending=!0;try{await c["a"].sendPO60Data({userKey:i["a"].user._key,studyKey:t,taskId:s,createdTS:new Date,phone:d["a"].device,po60Data:"discarded"}),await r["a"].setTaskCompletion(t,s,new Date),this.$router.push({name:"home"})}catch(a){this.isSending=!1,console.error(a),this.$q.notify({color:"negative",message:this.$t("errors.connectionError")+" "+a.message,icon:"report_problem"})}}},async mounted(){await this.downloadData()},async beforeDestroy(){try{await n["a"].disconnect()}catch(t){console.error("cannot disconnect miband3",t)}}},h=l,u=a("2877"),g=a("9989"),p=a("58ea"),m=a("9c40"),y=a("eebe"),w=a.n(y),v=Object(u["a"])(h,e,o,!1,null,null,null);s["default"]=v.exports;w()(v,"components",{QPage:g["a"],QCircularProgress:p["a"],QBtn:m["a"]})}}]);