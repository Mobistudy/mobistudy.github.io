(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[43],{7935:function(t,s,i){"use strict";i.r(s);var e=function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{staticClass:"q-pa-md"},[t.devices.length>1?i("div",[t._v(t._s(t.$t("studies.tasks.po60.moreDevices")))]):t._e(),t.devices.length>1?i("q-list",{staticClass:"q-mt-md",attrs:{bordered:""}},t._l(t.devices,(function(s){return i("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:s.id,attrs:{clickable:"",id:s.id},on:{click:function(i){return t.connect(s,!0)}}},[i("q-item-section",[t._v(t._s(s.id))])],1)})),1):t._e(),i("q-dialog",{attrs:{"transition-show":"scale","transition-hide":"scale","no-esc-dismiss":"","no-backdrop-dismiss":""},model:{value:t.instructionDialog,callback:function(s){t.instructionDialog=s},expression:"instructionDialog"}},[i("q-card",[i("div",{staticClass:"q-pa-sm"}),i("q-card-section",[i("div",{staticClass:"row no-wrap items-center"},[i("div",{staticClass:"col text-body1"},[i("p",[t._v(t._s(t.$t("studies.tasks.po60.takeMeasurement")))])])])])],1)],1),i("q-inner-loading",{attrs:{showing:t.showScanning}},[i("div",{staticClass:"text-overline",attrs:{color:"dark-grey"}},[t._v(t._s(t.$t("studies.tasks.po60.scanning")))]),i("q-spinner-dots",{attrs:{size:"40px",color:"primary"}})],1),i("q-inner-loading",{attrs:{showing:t.showConnecting}},[i("div",{staticClass:"text-overline",attrs:{color:"dark-grey"}},[t._v(t._s(t.$t("studies.tasks.po60.connecting")))]),i("q-spinner-dots",{attrs:{size:"40px",color:"primary"}})],1)],1)},n=[],o=(i("4e82"),i("e6cf"),i("3fd3")),a=i("6a6d"),c={name:"PO60ConnectPage",props:{studyKey:String,taskId:Number},data(){return{devices:[],instructionDialog:!1,showScanning:!1,showConnecting:!1,connectionAttempts:0,maxConnectionAttempts:5}},methods:{async scan(){this.instructionDialog=!0;try{this.devices=await o["a"].scan(25e3),this.instructionDialog=!1,0===this.devices.length?this.$q.dialog({title:this.$t("studies.tasks.po60.noDeviceTitle"),message:this.$t("studies.tasks.po60.noDevice"),cancel:this.$t("common.cancel"),ok:this.$t("common.retry"),persistent:!0}).onOk((t=>{this.scan()})).onCancel((()=>{this.abandon()})):1===this.devices.length?this.connect(this.devices[0]):this.devices.sort(((t,s)=>s.rssi-t.rssi))}catch(t){this.instructionDialog=!1,console.error("Scan error",t),this.$q.dialog({title:this.$t("errors.error"),message:this.$t("studies.tasks.po60.scanFailed"),cancel:this.$t("common.cancel"),ok:this.$t("common.retry"),persistent:!0}).onOk((t=>{this.scan()})).onCancel((()=>{this.abandon()}))}},async connect(t,s){try{s?this.showConnecting=!0:(this.instructionDialog=!0,this.$q.platform.is.ios&&await o["a"].scanForId(t.id,5e3)),this.connectionAttempts++,await o["a"].connect(t),this.instructionDialog=!1,this.showConnecting=!1,t.authenticated=!0,await a["a"].setDevicePO60(t),this.moveToDownloadPage()}catch(i){console.error(i),this.connectionAttempts<this.maxConnectionAttempts?(console.log("Attempting connect again...",this.connectionAttempts),this.connect(t)):(this.connectionAttempts=0,this.instructionDialog=!1,this.$q.dialog({title:this.$t("errors.error"),message:this.$t("studies.tasks.po60.connectionFail"),cancel:this.$t("common.cancel"),ok:this.$t("common.retry"),persistent:!0}).onOk((async()=>{await o["a"].disconnect(),t.authenticated?this.connect(t):this.scan()})).onCancel((()=>{this.abandon()})))}},abandon(){try{o["a"].disconnect()}catch(t){console.error("cannot disconnect pulse oximeter",t)}this.$router.push({name:"tasker"})},moveToDownloadPage(){this.$router.push({name:"po60DataDownload",params:{studyKey:this.studyKey,taskId:this.taskId}})}},async mounted(){let t=await a["a"].getDevicePO60();t?this.connect(t):this.scan()}},r=c,d=i("2877"),l=i("1c1c"),h=i("66e5"),m=i("4074"),p=i("24e8"),u=i("f09f"),g=i("068f"),v=i("a370"),k=i("74f7"),w=i("8380"),$=i("714f"),y=i("eebe"),D=i.n(y),C=Object(d["a"])(r,e,n,!1,null,null,null);s["default"]=C.exports;D()(C,"components",{QList:l["a"],QItem:h["a"],QItemSection:m["a"],QDialog:p["a"],QCard:u["a"],QImg:g["a"],QCardSection:v["a"],QInnerLoading:k["a"],QSpinnerDots:w["a"]}),D()(C,"directives",{Ripple:$["a"]})}}]);