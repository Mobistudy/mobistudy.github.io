(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[43],{c470:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t._self._c;return e("q-page",{attrs:{padding:""}},[e("div",{staticClass:"text-center text-h5 q-mt-lg"},[t._v("\n    "+t._s(t.$t("studies.tasks.drawing.title"))+"\n  ")]),e("p",{staticClass:"text-center text-subtitle1 q-mt-lg"},[t._v(t._s(t.$t("studies.tasks.drawing.instructions.start")))]),e("div",{staticClass:"row justify-center q-mb-xl fixed-bottom"},[e("canvas",{ref:"drawingCanvas",attrs:{width:"350",height:"350"}})])])},a=[],n=(i("14d9"),i("a5f6")),o=i("9bf1");let r;var h={name:"DrawingPage",props:{studyKey:String,taskId:Number},data:function(){return{startedTS:void 0,startTS:void 0,coords0:[],coords1:[],testNumber:0,totalVariabilitySquare:0,totalVariabilitySpiral:0,coordsSquare:0,coordsSpiral:0}},mounted(){this.$nextTick((function(){this.nextShape()})),this.$refs.drawingCanvas.addEventListener("touchmove",this.handleMove)},methods:{executeTest0(){this.startedTS=new Date,this.shapeStartTS=(new Date).getTime();let t=this.$refs.drawingCanvas.getContext("2d");t.beginPath(),t.moveTo(300,200),t.lineTo(300,50),t.lineTo(50,50),t.lineTo(50,300),t.lineTo(300,300),t.lineTo(300,200),t.lineWidth=1,t.stroke()},executeTest1(){this.shapeStartTS=(new Date).getTime();let t=this.$refs.drawingCanvas.getContext("2d");t.beginPath(),t.moveTo(300,200),t.lineTo(300,50),t.lineTo(50,50),t.lineTo(50,300),t.lineTo(250,300),t.lineTo(250,100),t.lineTo(100,100),t.lineTo(100,250),t.lineTo(200,250),t.lineTo(200,150),t.lineTo(150,150),t.lineTo(150,200),t.lineWidth=1,t.stroke()},nextShape(){0===this.testNumber?this.executeTest0():1===this.testNumber?this.executeTest1():2===this.testNumber&&this.completeTest()},handleMove(t){t.preventDefault();let e=this.$refs.drawingCanvas,i=t.touches?t.touches[0]:t;const{clientX:s,clientY:a}=i,{left:n,top:o}=e.getBoundingClientRect(),h=s-n,l=a-o;let d=e.getContext("2d");d.fillStyle="#459399",d.fillRect(h,l,4,4);let c=(new Date).getTime()-this.startedTS,u={x:h,y:l,ts:c};if(0===this.testNumber){this.coords0.push(u);let t=Math.min(this.distanceToLine(1,0,-300,h,-l),this.distanceToLine(1,0,-50,h,-l),this.distanceToLine(0,1,50,h,-l),this.distanceToLine(0,1,300,h,-l));t=Math.pow(t,2),this.totalVariabilitySquare+=t}else if(1===this.testNumber){this.coords1.push(u);let t=Math.min(this.distanceToLine(1,0,-300,h,-l),this.distanceToLine(1,0,-50,h,-l),this.distanceToLine(1,0,-250,h,-l),this.distanceToLine(1,0,-100,h,-l),this.distanceToLine(1,0,-200,h,-l),this.distanceToLine(1,0,-150,h,-l),this.distanceToLine(0,1,150,h,-l),this.distanceToLine(0,1,200,h,-l),this.distanceToLine(0,1,100,h,-l),this.distanceToLine(0,1,250,h,-l),this.distanceToLine(0,1,50,h,-l),this.distanceToLine(0,1,300,h,-l));t=Math.pow(t,2),this.totalVariabilitySpiral+=t}r&&clearTimeout(r),r=setTimeout((()=>{d.clearRect(0,0,e.width,e.height),this.testNumber=this.testNumber+1,this.nextShape()}),2e3)},distanceToLine(t,e,i,s,a){return Math.abs(t*s+e*a+i)/Math.sqrt(Math.pow(t,2)+Math.pow(e,2))},completeTest(){this.isCompleted=!0;let t=new Date,e={userKey:o["a"].user._key,participantKey:o["a"].user.participantKey,studyKey:this.studyKey,taskId:parseInt(this.taskId),taskType:"drawing",createdTS:new Date,phone:n["a"].device,summary:{startedTS:this.startedTS,completedTS:t,totalVariabilitySquare:this.totalVariabilitySquare/this.coords0.length,totalVariabilitySpiral:this.totalVariabilitySpiral/this.coords1.length},data:{square:{touchCoordinates:this.coords0,shapeCoordinates:[{x:300,y:200},{x:300,y:50},{x:50,y:50},{x:50,y:300},{x:300,y:300},{x:300,y:200}]},spiral:{touchCoordinates:this.coords1,shapeCoordinates:[{x:300,y:200},{x:300,y:50},{x:50,y:50},{x:50,y:300},{x:250,y:300},{x:250,y:100},{x:100,y:100},{x:100,y:250},{x:200,y:250},{x:200,y:150},{x:150,y:150},{x:150,y:200}]}}};this.$router.push({name:"drawingSummary",params:{report:e}})}},computed:{aqiLevel(){return this.environment.pollution&&this.environment.pollution.aqi?this.$t("studies.tasks.position.aqiscale.l"+this.environment.pollution.aqi):void 0}}},l=h,d=i("2877"),c=i("9989"),u=i("eebe"),T=i.n(u),p=Object(d["a"])(l,s,a,!1,null,null,null);e["default"]=p.exports;T()(p,"components",{QPage:c["a"]})}}]);